{
  "hash": "f6c266b1f8c4c27ce9cf569a2f415dbc",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"TORUS input prep\"\ndate: 2024-7-15\nformat: html\ncategories: ['torus', 'enrichment']\ncode-fold: false\nexecute:\n  include: true\n  eval: true\n  cache: false\n  echo: true\n---\n\n# Problem with runing TORUS\n\n1. getting lots of nan values in the output\n2. underflow errors\n3. possible infinite loop?\n\n\n# How I run TORUS\n\n1. input data file\n\nGenes are actually intron ids. Results are from qtltools, where beta and p-value are direct output but t-stat are calculated from p-value. \n\n::: {#a7dfd3e8 .cell execution_count=1}\n``` {.bash .cell-code}\nzcat ../data/torus/torus_Liver_p-sqtl.txt.gz| head\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nchr1_1000731_C_T_b38\tchr1:941306:942135:clu_8_+:PR\t0.410522\t4.529243463388074\t1.00142e-05\nchr1_1079456_A_G_b38\tchr1:1082987:1084352:clu_1808_-:PR\t-0.362335\t-5.202902246877481\t4.7261800000000006e-07\nchr1_1091327_C_A_b38\tchr1:1090428:1091471:clu_1810_-:PR\t-0.444126\t-5.672460184876813\t4.72455e-08\nchr1_1091327_C_A_b38\tchr1:1091374:1091471:clu_1810_-:PR\t0.382368\t4.477479420903548\t1.25005e-05\nchr1_1217733_G_A_b38\tchr1:1217688:1218457:clu_1814_-:PR\t0.604832\t5.049136688493565\t9.74565e-07\nchr1_1217733_G_A_b38\tchr1:1217804:1218457:clu_1814_-:PR\t-0.615276\t-5.082449530379815\t8.34233e-07\nchr1_1609890_C_T_b38\tchr1:1642001:1642346:clu_1843_-:PR\t-0.540764\t-4.9038885121917\t1.90325e-06\nchr1_1609890_C_T_b38\tchr1:1642508:1645125:clu_1844_-:PR\t1.04555\tinf\t1.22099e-17\nchr1_1609890_C_T_b38\tchr1:1645262:1649498:clu_1844_-:PR\t-0.865793\t-7.730643217161971\t4.64391e-13\nchr1_1724661_CGATG_C_b38\tchr1:1707584:1708179:clu_1851_-:PR\t-0.472149\t-5.24117373691248\t3.93775e-07\n\ngzip: stdout: Broken pipe\n```\n:::\n:::\n\n\n2. SNP and gene map files.\n\nGenes are actually intron ids.\n\n::: {#45911d1d .cell execution_count=2}\n``` {.bash .cell-code}\nzcat ../data/torus/torus_Liver_snp_map.txt.gz | head\nzcat ../data/torus/torus_Liver_gene_map.txt.gz | head\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nchr1_1000731_C_T_b38\tchr1\t1000731\nchr1_1079456_A_G_b38\tchr1\t1079456\nchr1_1091327_C_A_b38\tchr1\t1091327\nchr1_1217733_G_A_b38\tchr1\t1217733\nchr1_1453870_A_C_b38\tchr1\t1453870\nchr1_1609890_C_T_b38\tchr1\t1609890\nchr1_1680059_G_A_b38\tchr1\t1680059\nchr1_1724661_CGATG_C_b38\tchr1\t1724661\nchr1_1737789_T_C_b38\tchr1\t1737789\nchr1_1706027_G_A_b38\tchr1\t1706027\n\ngzip: stdout: Broken pipe\nchr1:941306:942135:clu_8_+:PR\tchr1\t941307\t942135\nchr1:1082987:1084352:clu_1808_-:PR\tchr1\t1082988\t1084352\nchr1:1090428:1091471:clu_1810_-:PR\tchr1\t1090429\t1091471\nchr1:1091374:1091471:clu_1810_-:PR\tchr1\t1091375\t1091471\nchr1:1217688:1218457:clu_1814_-:PR\tchr1\t1217689\t1218457\nchr1:1217804:1218457:clu_1814_-:PR\tchr1\t1217805\t1218457\nchr1:1389047:1390229:clu_1835_-:UP\tchr1\t1389048\t1390229\nchr1:1642001:1642346:clu_1843_-:PR\tchr1\t1642002\t1642346\nchr1:1642508:1645125:clu_1844_-:PR\tchr1\t1642509\t1645125\nchr1:1642508:1649498:clu_1844_-:UP\tchr1\t1642509\t1649498\n\ngzip: stdout: Broken pipe\n```\n:::\n:::\n\n\n3. SNP annotation file\n\nDownloaded from GTEx protal\n\n::: {#ec18634f .cell execution_count=3}\n``` {.bash .cell-code}\nzcat ../data/WGS_Feature_overlap_collapsed_VEP_short_4torus.MAF01.txt.gz | head | cut -f 1-5\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSNP\tenhancer_d\tpromoter_d\topen_chromatin_region_d\tpromoter_flanking_region_d\nchr1_13550_G_A_b38\t1\t0\t0\t0\nchr1_14671_G_C_b38\t0\t0\t0\t0\nchr1_14677_G_A_b38\t0\t0\t0\t0\nchr1_16841_G_T_b38\t0\t0\t0\t0\nchr1_16856_A_G_b38\t0\t0\t0\t0\nchr1_17005_A_G_b38\t0\t0\t0\t0\nchr1_17147_G_A_b38\t0\t0\t0\t0\nchr1_17407_G_A_b38\t0\t0\t0\t0\nchr1_17408_C_G_b38\t0\t0\t0\t0\n\ngzip: stdout: Broken pipe\n```\n:::\n:::\n\n\n3. Run TORUS\n\n::: {#b8aba01f .cell execution_count=4}\n``` {.bash .cell-code}\ntorus -est \\\n  -d ../data/torus/torus_Liver_p-sqtl.txt.gz \\\n  -smap ../data/torus/torus_Liver_snp_map.txt.gz \\\n  -gmap ../data/torus/torus_Liver_gene_map.txt.gz \\\n  -annot ../data/WGS_Feature_overlap_collapsed_VEP_short_4torus.MAF01.txt.gz > ../data/torus/Liver-p-enrichment.txt\ntorus -est \\\n  -d ../data/torus/torus_Liver_u-sqtl.txt.gz \\\n  -smap ../data/torus/torus_Liver_snp_map.txt.gz \\\n  -gmap ../data/torus/torus_Liver_gene_map.txt.gz \\\n  -annot ../data/WGS_Feature_overlap_collapsed_VEP_short_4torus.MAF01.txt.gz > ../data/torus/Liver-u-enrichment.txt\n```\n:::\n\n\n4. Results\n\nLots of nan values in stdout and the final output. Many seems to be in infinit loop?\n\n::: {#b23a6610 .cell execution_count=5}\n``` {.bash .cell-code}\ncat ../data/torus/torus_Spleen_enrichment_p-sqtl.txt\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n                Intercept     25.061        24.360     25.761\n               enhancer.1      4.669     -64709.147  64718.485\n               promoter.1     -0.001       -19.319     19.316\n  open_chromatin_region.1     -0.001       -19.539     19.536\npromoter_flanking_region.1      0.015      -209.060    209.090\n      CTCF_binding_site.1     -0.002       -26.457     26.454\n        TF_binding_site.1      4.925     -68245.675  68255.525\n    3_prime_UTR_variant.1      2.918     -40441.404  40447.240\n    5_prime_UTR_variant.1      3.661     -50737.866  50745.188\n     frameshift_variant.1     10.619     -147161.543  147182.781\n         intron_variant.1      0.054      -745.464    745.571\n       missense_variant.1      2.755     -38174.010  38179.519\nnon_coding_transcript_exon_variant.1      1.781     -24679.474  24683.035\nsplice_acceptor_variant.1     10.076     -139633.278  139653.430\n   splice_donor_variant.1      6.575     -91115.245  91128.394\n  splice_region_variant.1      5.130     -71092.879  71103.139\n            stop_gained.1      8.484     -117570.204  117587.171\n     synonymous_variant.1      4.289     -59431.429  59440.006\n```\n:::\n:::\n\n\n# TORUS instructed data format\n\nFrom [torus](https://github.com/xqwen/torus/tree/master/examples/GTEx_liver)\n\n1. input data file\n\n```\nSNP\tgene\tbeta\t t-stat\tp-value\n1_30923_G_T_b37\tENSG00000227232.4\t0.00399184253633977\t0.0232610959574911\t0.981503781647425\n1_51479_T_A_b37\tENSG00000227232.4\t-0.0264207753473278\t-0.101592859539226\t0.919350965625195\n1_55299_C_T_b37\tENSG00000227232.4\t-0.224656599916996\t-0.977243563498281\t0.331590265844854\n\n```\n\n2. SNP annotation file\n\n```\nSNP   binding_d\nchr1.51479  0\nchr1.52058  2\nchr1.52238  1\n```\n\n3. SNP and gene map files\n\nTo control for SNP distance to TSS, TORUS **requires** gene TSS information and SNP position files (i.e., gene map and SNP map).\n\nGene map file format:\n```\nENSG00000237683  1  139379 139379\nENSG00000237491  1  714162 714162\nENSG00000230021  1  741274 741274\n```\n\nsnps map\n\n```\nchr1.51479  1  51479\nchr1.52058  1  52058\nchr1.52238  1  52238\n\n```\n\n4. Output from enrichment analysis\n\n\nThe first column represents the annotation name and its corresponding level (for a categorical variable). The second column is the point estimate (MLE) of the log odds ratio. Columns 3-4 represent the 95% confidence interval for the corresponding point estimate.\n```\nbinding.1      0.623         0.226      1.021\nbinding.2      1.222         0.946      1.499\n```\n\n\n# MatrixEQTL format\n\nSNP map file format:\n\n```\nsnp\tchr\tpos\nSnp_01\tchr1\t721289\nSnp_02\tchr1\t752565\nSnp_03\tchr1\t777121\nSnp_04\tchr1\t785988\nSnp_05\tchr1\t792479\nSnp_06\tchr1\t798958\n```\nGENE map file format:\n\n```\ngeneid\tchr\ts1\ts2\nGene_01\tchr1\t721289\t731289\nGene_02\tchr1\t752565\t762565\nGene_03\tchr1\t777121\t787121\nGene_04\tchr1\t785988\t795988\nGene_05\tchr1\t792479\t802479\nGene_06\tchr1\t798958\t808958\nGene_07\tchr1\t888658\t898658\n```\n\n",
    "supporting": [
      "2024-07-15-torus-input-prep_files"
    ],
    "filters": [],
    "includes": {}
  }
}