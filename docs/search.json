[
  {
    "objectID": "analysis/2024-08-07-GWAS-sQTL-coloc.html",
    "href": "analysis/2024-08-07-GWAS-sQTL-coloc.html",
    "title": "coloc with GWAS and sQTL",
    "section": "",
    "text": "Data description\n\nAD GWAS\n\nformatted gwas summsary stats description"
  },
  {
    "objectID": "analysis/2024-08-05-eQTL-sQTL-coloc-tally.html",
    "href": "analysis/2024-08-05-eQTL-sQTL-coloc-tally.html",
    "title": "eQTL sQTL coloc with HyprColoc tally",
    "section": "",
    "text": "Intro\nColoc using HyprColoc. Detailed procedures in ../code/workflow/rules/coloc.smk. Briefly, first collect sQTL and eQTLs with FDR = 0.1. Then get intron/gene pairs. Run nominal pass to get betas and standard errors. Then run HyprColoc on shared SNPs on each pair.\n\n\ncode\n\n\nCode\nsuppressMessages(library(tidyverse))\nsuppressMessages(library(glue))\nsuppressMessages(library(data.table))\n\n\n\n\nCode\nbase_dir = '../code/results/coloc/sqtl-eqtl/GTEx'\ncoloc_result_pat = '.*coloc-res.txt'\ncoloc_res_files = list.files(base_dir, pattern = coloc_result_pat, full.names = TRUE, recursive = TRUE)\n\ntissues = str_split(coloc_res_files, '/', simplify = T) %&gt;% .[, 7] %&gt;% unique\nnames(tissues) = tissues\ncoloc_files = map(tissues, ~coloc_res_files[str_detect(coloc_res_files, .x)]) %&gt;% \n  map(~naturalsort::naturalsort(.x))\n\ncoloc_res = imap(\n  coloc_files,\n  \\(fl, t) {\n    map_dfr(fl, ~fread(.x) %&gt;% mutate(tissue = t))\n  }\n)\n\n\n\n\nCode\ncoloc_res = map(\n  coloc_res,\n  \\(dt) {\n    intron_gene = str_split(dt$id, '\\\\|', simplify = T)\n    dt = mutate(dt, intron = intron_gene[, 1], gene = intron_gene[, 2])\n    dt = mutate(dt, itype = str_extract(intron, 'PR|UP|NE'))\n    return(dt)\n  }\n)\n\n\ncoloc_res = map(\n  coloc_res,\n  \\(dt) dt[posterior_prob &gt; 0.7]\n)\n\n\nNumber of significant coloc results per tissue with posterior probability &gt; 0.7\n\n\nCode\ncoloc_res %&gt;% \n  map(\\(dt) dt[, .(N = uniqueN(id)), by = itype])\n\n\n$Liver\n    itype     N\n   &lt;char&gt; &lt;int&gt;\n1:     PR   379\n2:     UP   154\n\n$Lung\n    itype     N\n   &lt;char&gt; &lt;int&gt;\n1:     PR  1334\n2:     UP   408\n3:     NE     1\n\n$`Muscle-Skeletal`\n    itype     N\n   &lt;char&gt; &lt;int&gt;\n1:     PR  1452\n2:     UP   441\n3:     NE     1"
  },
  {
    "objectID": "analysis/2024-07-25-plot-beta-beta-heatmap.html",
    "href": "analysis/2024-07-25-plot-beta-beta-heatmap.html",
    "title": "Plot heatmap of effect size correlation between eQTL and sQTL",
    "section": "",
    "text": "Intro\nThe goal is to compute the correlations between sQTL beta and eQTL beta for top p vs. u sQTL top SNPs in a heatmap. It effectively summarises the 49 beta vs. beta scatter plots.\ndata:\n\np vs. u sQTL top SNPs\nregression slope in sQTL mapping\nregression slope in eQTL mapping\n\ndo this for each of the 49 tissues. Result is a 2x49 matrix where\n\nrow labels: u or p sQTL (2)\ncol labels: tissue (49)\nvalues: correlation value of betas.\n\nplot heatmap:\n\nsplit heatmap into 5 sub heatmaps, each is 2x10 (9) matrix"
  },
  {
    "objectID": "analysis/2024-07-16-sQTL-beta-beta-plot-check-WholeBlood.html",
    "href": "analysis/2024-07-16-sQTL-beta-beta-plot-check-WholeBlood.html",
    "title": "Check sqtl beta beta corr plot",
    "section": "",
    "text": "Check sqtl beta beta corr plot\n\n\n[1] \"../smk-plots/gtex-sqtl-enrichment-v4/Cells-EBV-transformedlymphocytes-scatter.png\"\n[2] \"../smk-plots/gtex-sqtl-enrichment-v4/Liver-scatter.png\"                           \n[3] \"../smk-plots/gtex-sqtl-enrichment-v4/WholeBlood-scatter.png\"                      \n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 2: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 3: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\nTake a closer look at whole blood\nConsider selecting random intron for PR also try random selection for UP\n\n\nRemoved 208 transcriptional snps\n\n\n\n\nWarning: Transformation introduced infinite values in continuous x-axis\n\n\nWarning: Removed 1430 rows containing non-finite values (`stat_ecdf()`).\n\n\n\n\n\n\n\n\n\nRemove introns with low read counts (less than 10 reads).\n\n\n[1] \"Number of sQTLs removed due to low read counts:\"\n\n\n   ctype    N\n1:    PR 1162\n2: PR,UP  174\n\n\n[1] \"Number of sQTLs remaining:\"\n\n\n   ctype    N\n1: PR,UP 1291\n2:    PR 1763\n\n\nCorrelation test for WholeBlood:\nOriginal:\n\n\n          ctype         pval  estimate xpos ypos\nUP Unproductive 6.552652e-21 -0.255785    0    0\nPR   Productive 8.060112e-32 -0.272386    0    0\n\n\nsplit by intron bins:\n\n\n    ctype binsbyMean   N\n 1:    PR      (0,1] 710\n 2:    PR      (1,2] 300\n 3:    PR      (2,5] 444\n 4:    PR     (5,10] 336\n 5:    PR    (10,20] 291\n 6:    PR    (20,50] 388\n 7:    PR   (50,100] 183\n 8:    PR  (100,Inf] 313\n 9: PR,UP      (0,1] 621\n10: PR,UP      (1,2] 277\n11: PR,UP      (2,5] 287\n12: PR,UP     (5,10] 118\n13: PR,UP    (10,20]  86\n14: PR,UP    (20,50]  59\n15: PR,UP   (50,100]  14\n16: PR,UP  (100,Inf]  16\n\n\n\n\n\n\n\n\n\n\n\nbefore removing low reads\n\n\n\n\n\n\n\n\n\nafter removing low reads\n\n\n\n\n\n\n\nFigure 4: Beta beta correlation plot for WholeBlood:\n\n\n\n\n\n$`(0,1]`\n          ctype         pval   estimate xpos ypos\nPR   Productive 9.439602e-28 -0.3937742    0    0\nUP Unproductive 3.360361e-18 -0.3393361    0    0\n\n$`(1,2]`\n          ctype         pval   estimate xpos ypos\nPR   Productive 0.0004428076 -0.2015878    0    0\nUP Unproductive 0.0448751320 -0.1206233    0    0\n\n$`(10,20]`\n          ctype      pval   estimate xpos ypos\nPR   Productive 0.0189258 -0.1375205    0    0\nUP Unproductive 0.3205614  0.1083808    0    0\n\n$`(100,Inf]`\n          ctype       pval  estimate xpos ypos\nPR   Productive 0.04477046 0.1135186    0    0\nUP Unproductive 0.12066092 0.4040155    0    0\n\n$`(2,5]`\n          ctype         pval   estimate xpos ypos\nUP Unproductive 6.826288e-06 -0.2620576    0    0\nPR   Productive 4.277786e-07 -0.2371908    0    0\n\n$`(20,50]`\n          ctype       pval     estimate xpos ypos\nPR   Productive 0.09007917 -0.086167490    0    0\nUP Unproductive 0.95834860  0.006947826    0    0\n\n$`(5,10]`\n          ctype       pval     estimate xpos ypos\nPR   Productive 0.03117262 -0.117587458    0    0\nUP Unproductive 0.92852704  0.008346092    0    0\n\n$`(50,100]`\n          ctype      pval   estimate xpos ypos\nUP Unproductive 0.1687407 0.38941135    0    0\nPR   Productive 0.7548967 0.02323378    0    0"
  },
  {
    "objectID": "analysis/2024-07-16-sQTL-beta-beta-plot-check-LCL.html",
    "href": "analysis/2024-07-16-sQTL-beta-beta-plot-check-LCL.html",
    "title": "Check sqtl beta beta corr plot - LCL",
    "section": "",
    "text": "Check sqtl beta beta corr plot\n\n\n[1] \"../smk-plots/gtex-sqtl-enrichment-v4/Cells-EBV-transformedlymphocytes-scatter.png\"\n[2] \"../smk-plots/gtex-sqtl-enrichment-v4/Liver-scatter.png\"                           \n[3] \"../smk-plots/gtex-sqtl-enrichment-v4/WholeBlood-scatter.png\"                      \n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 2: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 3: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\nTake a closer look at whole blood\nConsider selecting random intron for PR also try random selection for UP\n\n\nRemoved 105 transcriptional snps\n\n\n\n\nWarning: Transformation introduced infinite values in continuous x-axis\n\n\nWarning: Removed 327 rows containing non-finite values (`stat_ecdf()`).\n\n\n\n\n\n\n\n\n\nRemove introns with low read counts (less than 10 reads).\n\n\n[1] \"Number of sQTLs removed due to low read counts:\"\n\n\n   ctype    N\n1: PR,UP  174\n2:    PR 1078\n\n\n[1] \"Number of sQTLs remaining:\"\n\n\n   ctype   N\n1:    PR 786\n2: PR,UP 653\n\n\nCorrelation test for Cells-EBV-transformedlymphocytes:\nOriginal:\n\n\n          ctype         pval   estimate xpos ypos\nPR   Productive 1.022677e-05 -0.1551985    0    0\nUP Unproductive 1.278154e-17 -0.3239933    0    0\n\n\nsplit by intron bins:\n\n\n    ctype binsbyMean   N\n 1:    PR      (0,1] 168\n 2:    PR      (1,2] 130\n 3:    PR      (2,5] 255\n 4:    PR     (5,10] 248\n 5:    PR    (10,20] 238\n 6:    PR    (20,50] 309\n 7:    PR   (50,100] 205\n 8:    PR  (100,Inf] 338\n 9: PR,UP      (0,1] 151\n10: PR,UP      (1,2] 126\n11: PR,UP      (2,5] 237\n12: PR,UP     (5,10] 147\n13: PR,UP    (10,20]  98\n14: PR,UP    (20,50]  58\n15: PR,UP   (50,100]  12\n16: PR,UP  (100,Inf]   6\n\n\n\n\n\n\n\n\n\n\n\nbefore removing low reads\n\n\n\n\n\n\n\n\n\nafter removing low reads\n\n\n\n\n\n\n\nFigure 4: Beta beta correlation plot for Cells-EBV-transformedlymphocytes:\n\n\n\n\n\n$`(0,1]`\n          ctype         pval   estimate xpos ypos\nPR   Productive 1.254156e-07 -0.3940962    0    0\nUP Unproductive 1.159352e-06 -0.3836414    0    0\n\n$`(1,2]`\n          ctype       pval     estimate xpos ypos\nUP Unproductive 0.02402581 -0.200991146    0    0\nPR   Productive 0.92858376 -0.007937331    0    0\n\n$`(10,20]`\n          ctype       pval     estimate xpos ypos\nUP Unproductive 0.01042595 -0.257659300    0    0\nPR   Productive 0.92471101  0.006157967    0    0\n\n$`(100,Inf]`\n          ctype       pval   estimate xpos ypos\nPR   Productive 0.39343452 0.04656646    0    0\nUP Unproductive 0.08579947 0.75021041    0    0\n\n$`(2,5]`\n          ctype         pval   estimate xpos ypos\nPR   Productive 9.594439e-04 -0.2055858    0    0\nUP Unproductive 1.568447e-08 -0.3569761    0    0\n\n$`(20,50]`\n          ctype       pval    estimate xpos ypos\nPR   Productive 0.67153749  0.02421734    0    0\nUP Unproductive 0.02685682 -0.29067908    0    0\n\n$`(5,10]`\n          ctype         pval   estimate xpos ypos\nPR   Productive 0.8150535088  0.0149280    0    0\nUP Unproductive 0.0002438611 -0.2982141    0    0\n\n$`(50,100]`\n          ctype      pval    estimate xpos ypos\nPR   Productive 0.2844609  0.07511026    0    0\nUP Unproductive 0.8289487 -0.06996110    0    0"
  },
  {
    "objectID": "analysis/2024-07-11-GTEx-sqtl-enrich.html",
    "href": "analysis/2024-07-11-GTEx-sqtl-enrich.html",
    "title": "GTEx sQTL enrichment - updated (V4)",
    "section": "",
    "text": "The underlying data for both the qqplot and the scatter plot are the from this procedure:\n\nMap sQTLs using permutation pass with QTLtools against leafcutter2 output. Each phenotype is an intron.\nPermpass result report a top SNP for each intron. Use the collection of these top SNPs to subset genotype VCF file.\nRun nominal pass for eQTL with expression data and the subsetted genotype VCF file. This effectively run regression analysis of each top sQTL SNP against gene expression.\n\nThen for the qqplot, I plotted the pvalue of expression regression for each productive vs. unproductive sQTLs top SNP.\nFor the scatter plot, each top SNP is the top SNP of a productive or unprodutive sQTL. X axis is SNP’s regression slope for gene expression, and Y axis is the regression slope of splicing.\nNote each sQTL is either a productive or unproductive sQTLs, and represent a intron cluster. A productive sQTL is a cluster that only have productive introns. The strongest intron is chosen to represent the cluster (instead of aggregated of all the introns).\nAn unproductive sQTL is a cluster that has both productive intron and unproductive introns with permutation pass q value &lt; 0.1. The best intron (largest top SNP slope) is chosen to represent the cluster as unproductive sQTL. Note, comparing to previous version, here for u-sQTLs (ctype = PR,UP) select the best unproductive intron to represent the cluster.\n\n\n\n\n\n\nNote\n\n\n\nThis update removed the following categories of SNPs from the GTEx VEP annotation file:\n\nenhancer_d\npromoter_d\npromoter_flanking_region_d\n\nqqplot Y axis is flipped if sQTL slope and eQTL slope are in opposite direction.\n\n\n\nEnrichment of sQTL in eQTL pvalues\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1\n\n\n\n\n\n\n\n\n\n\n\nFigure 2\n\n\n\n\n\n\n\n\n\n\n\nFigure 3\n\n\n\n\n\n\n\n\n\n\n\nFigure 4\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 5\n\n\n\n\n\n\n\n\n\n\n\nFigure 6\n\n\n\n\n\n\n\n\n\n\n\nFigure 7\n\n\n\n\n\n\n\n\n\n\n\nFigure 8\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 9\n\n\n\n\n\n\n\n\n\n\n\nFigure 10\n\n\n\n\n\n\n\n\n\n\n\nFigure 11\n\n\n\n\n\n\n\n\n\n\n\nFigure 12\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 13\n\n\n\n\n\n\n\n\n\n\n\nFigure 14\n\n\n\n\n\n\n\n\n\n\n\nFigure 15\n\n\n\n\n\n\n\n\n\n\n\nFigure 16\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 17\n\n\n\n\n\n\n\n\n\n\n\nFigure 18\n\n\n\n\n\n\n\n\n\n\n\nFigure 19\n\n\n\n\n\n\n\n\n\n\n\nFigure 20\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 21\n\n\n\n\n\n\n\n\n\n\n\nFigure 22\n\n\n\n\n\n\n\n\n\n\n\nFigure 23\n\n\n\n\n\n\n\n\n\n\n\nFigure 24\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 25\n\n\n\n\n\n\n\n\n\n\n\nFigure 26\n\n\n\n\n\n\n\n\n\n\n\nFigure 27\n\n\n\n\n\n\n\n\n\n\n\nFigure 28\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 29\n\n\n\n\n\n\n\n\n\n\n\nFigure 30\n\n\n\n\n\n\n\n\n\n\n\nFigure 31\n\n\n\n\n\n\n\n\n\n\n\nFigure 32\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 33\n\n\n\n\n\n\n\n\n\n\n\nFigure 34\n\n\n\n\n\n\n\n\n\n\n\nFigure 35\n\n\n\n\n\n\n\n\n\n\n\nFigure 36\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 37\n\n\n\n\n\n\n\n\n\n\n\nFigure 38\n\n\n\n\n\n\n\n\n\n\n\nFigure 39\n\n\n\n\n\n\n\n\n\n\n\nFigure 40\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 41\n\n\n\n\n\n\n\n\n\n\n\nFigure 42\n\n\n\n\n\n\n\n\n\n\n\nFigure 43\n\n\n\n\n\n\n\n\n\n\n\nFigure 44\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 45\n\n\n\n\n\n\n\n\n\n\n\nFigure 46\n\n\n\n\n\n\n\n\n\n\n\nFigure 47\n\n\n\n\n\n\n\n\n\n\n\nFigure 48\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 49\n\n\n\n\n\n\n\n\nComparison of sQTL (top SNP beta) and eQTL effect size (nominal beta of same top sQTL SNP)\n\n\n\n\n\n\nNote\n\n\n\n\ncor.test used pearson correlation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 50: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 51: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 52: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 53: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 54: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 55: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 56: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 57: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 58: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 59: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 60: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 61: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 62: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 63: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 64: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 65: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 66: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 67: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 68: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 69: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 70: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 71: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 72: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 73: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 74: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 75: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 76: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 77: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 78: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 79: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 80: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 81: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 82: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 83: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 84: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 85: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 86: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 87: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 88: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 89: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 90: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 91: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 92: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 93: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 94: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 95: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 96: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 97: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 98: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\nqqplot where both same direction and different direction of sQTL and eQTL effect size are shown\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 99\n\n\n\n\n\n\n\n\n\n\n\nFigure 100\n\n\n\n\n\n\n\n\n\n\n\nFigure 101\n\n\n\n\n\n\n\n\n\n\n\nFigure 102\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 103\n\n\n\n\n\n\n\n\n\n\n\nFigure 104\n\n\n\n\n\n\n\n\n\n\n\nFigure 105\n\n\n\n\n\n\n\n\n\n\n\nFigure 106\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 107\n\n\n\n\n\n\n\n\n\n\n\nFigure 108\n\n\n\n\n\n\n\n\n\n\n\nFigure 109\n\n\n\n\n\n\n\n\n\n\n\nFigure 110\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 111\n\n\n\n\n\n\n\n\n\n\n\nFigure 112\n\n\n\n\n\n\n\n\n\n\n\nFigure 113\n\n\n\n\n\n\n\n\n\n\n\nFigure 114\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 115\n\n\n\n\n\n\n\n\n\n\n\nFigure 116\n\n\n\n\n\n\n\n\n\n\n\nFigure 117\n\n\n\n\n\n\n\n\n\n\n\nFigure 118\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 119\n\n\n\n\n\n\n\n\n\n\n\nFigure 120\n\n\n\n\n\n\n\n\n\n\n\nFigure 121\n\n\n\n\n\n\n\n\n\n\n\nFigure 122\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 123\n\n\n\n\n\n\n\n\n\n\n\nFigure 124\n\n\n\n\n\n\n\n\n\n\n\nFigure 125\n\n\n\n\n\n\n\n\n\n\n\nFigure 126\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 127\n\n\n\n\n\n\n\n\n\n\n\nFigure 128\n\n\n\n\n\n\n\n\n\n\n\nFigure 129\n\n\n\n\n\n\n\n\n\n\n\nFigure 130\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 131\n\n\n\n\n\n\n\n\n\n\n\nFigure 132\n\n\n\n\n\n\n\n\n\n\n\nFigure 133\n\n\n\n\n\n\n\n\n\n\n\nFigure 134\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 135\n\n\n\n\n\n\n\n\n\n\n\nFigure 136\n\n\n\n\n\n\n\n\n\n\n\nFigure 137\n\n\n\n\n\n\n\n\n\n\n\nFigure 138\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 139\n\n\n\n\n\n\n\n\n\n\n\nFigure 140\n\n\n\n\n\n\n\n\n\n\n\nFigure 141\n\n\n\n\n\n\n\n\n\n\n\nFigure 142\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 143\n\n\n\n\n\n\n\n\n\n\n\nFigure 144\n\n\n\n\n\n\n\n\n\n\n\nFigure 145\n\n\n\n\n\n\n\n\n\n\n\nFigure 146\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 147"
  },
  {
    "objectID": "analysis/2024-06-25-pyfastx-1-or-0-base.html",
    "href": "analysis/2024-06-25-pyfastx-1-or-0-base.html",
    "title": "Should leafcutter 2 be using 1 or 0 based coordinates?",
    "section": "",
    "text": "Does pyfastx use 0 or 1 based coordinates?\nanswer: pyfastx does use 1 based coordiantes for the fa.fetch() method. In addition, how stop codon and and transcripts were constructed needs scrutiny in because of how base is handled.\n\n\nCode\nimport os\nimport pyfastx\n\n\n\n\nCode\nprint(os.getcwd())\n\n\n/project/yangili1/cdai/splice-pub/analysis\n\n\n\n\nCode\nfa_file = './test.fa'\n\n\n\n\nCode\nwith open(fa_file) as f:\n  fa_text = f.readlines()\n\n\n\n\nCode\n  fa_text\n\n\n['&gt;JZ822577.1 contig1 cDNA library of flower petals in tree peony by suppression subtractive hybridization Paeonia suffruticosa cDNA, mRNA sequence\\n',\n 'CTCTAGAGATTACTTCTTCACATTCCAGATCACTCAGGCTCTTTGTCATTTTAGTTTGACTAGGATATCG\\n',\n 'AGTATTCAAGCTCATCGCTTTTGGTAATCTTTGCGGTGCATGCCTTTGCATGCTGTATTGCTGCTTCATC\\n',\n 'ATCCCCTTTGACTTGTGTGGCGGTGGCAAGACATCCGAAGAGTTAAGCGATGCTTGTCTAGTCAATTTCC\\n',\n 'CCATGTACAGAATCATTGTTGTCAATTGGTTGTTTCCTTGATGGTGAAGGGGCTTCAATACATGAGTTCC\\n',\n 'AAACTAACATTTCTTGACTAACACTTGAGGAAGAAGGACAAGGGTCCCCATGT\\n',\n '&gt;JZ822578.1 contig2 cDNA library of flower petals in tree peony by suppression subtractive hybridization Paeonia suffruticosa cDNA, mRNA sequence\\n',\n 'TACATGGGGATGGCTCCCCAACTAAGCCATTTGCAGTTCCCAATACATGACAGTATAAAAAAGATTATAT\\n',\n 'AACACAAGAACTCCATGTGGTTGTTTTTGACCTGAAGTGGGCGAAATCTTGTAGCAATGGAGCCAAATGA\\n',\n 'TCAATCTTTTCTTTCACCTACTAGTAGTGATGAAAGGTTGGAAGTTGCTGGGGATCTTTTGGAAGAGTGC\\n',\n 'TGGTTCTTTGAAAACATACTTGATAGAAAAGCGAGGATGTTGAGATGTCATTCTGACCCTTGTCCTTCTT\\n',\n 'CCTCAAGTGTTAGTCAAGAAATGTTAGTTTGGAACTCATGTATTGAAGCCCCTTCACCATCAAGGAAACA\\n',\n 'ACCAATTGACAACAATGATTCTGTACAACCAAAAGAAAGCGAATCGACTCAATCATCATCTCGCCATGGT\\n',\n 'TTGCTTCGAGCACCGTCCTTACCACCTTGTATAGGGAGAAAAGGAAGTGAACCCAGGACGAGCAAATTGA\\n',\n 'CTAGACAAGCATCGCTTAACTCTTCGGATGTCTTGCCACCGCCACACAAGTCAAAGGGGATGATGAAGCA\\n',\n 'GCAATACAGCATGCAAAGGCATGCACCTCAAAGATTACCAAAAGCGATGAGCTTGAATACTCGATATCCT\\n',\n 'AGTCAAACTAAAATGACAAAGAGCCTGAGTGATCTGGAATGTGAAGAAGT\\n']\n\n\n\n\nCode\nfa = pyfastx.Fasta(fa_file)\n\n\n\n\nCode\nfor seq in fa:\n  print(seq.name)\n  print(seq.seq)\n  print(seq.description)\n  print('\\n\\n')\n\n\nJZ822577.1\nCTCTAGAGATTACTTCTTCACATTCCAGATCACTCAGGCTCTTTGTCATTTTAGTTTGACTAGGATATCGAGTATTCAAGCTCATCGCTTTTGGTAATCTTTGCGGTGCATGCCTTTGCATGCTGTATTGCTGCTTCATCATCCCCTTTGACTTGTGTGGCGGTGGCAAGACATCCGAAGAGTTAAGCGATGCTTGTCTAGTCAATTTCCCCATGTACAGAATCATTGTTGTCAATTGGTTGTTTCCTTGATGGTGAAGGGGCTTCAATACATGAGTTCCAAACTAACATTTCTTGACTAACACTTGAGGAAGAAGGACAAGGGTCCCCATGT\nJZ822577.1 contig1 cDNA library of flower petals in tree peony by suppression subtractive hybridization Paeonia suffruticosa cDNA, mRNA sequence\n\n\n\nJZ822578.1\nTACATGGGGATGGCTCCCCAACTAAGCCATTTGCAGTTCCCAATACATGACAGTATAAAAAAGATTATATAACACAAGAACTCCATGTGGTTGTTTTTGACCTGAAGTGGGCGAAATCTTGTAGCAATGGAGCCAAATGATCAATCTTTTCTTTCACCTACTAGTAGTGATGAAAGGTTGGAAGTTGCTGGGGATCTTTTGGAAGAGTGCTGGTTCTTTGAAAACATACTTGATAGAAAAGCGAGGATGTTGAGATGTCATTCTGACCCTTGTCCTTCTTCCTCAAGTGTTAGTCAAGAAATGTTAGTTTGGAACTCATGTATTGAAGCCCCTTCACCATCAAGGAAACAACCAATTGACAACAATGATTCTGTACAACCAAAAGAAAGCGAATCGACTCAATCATCATCTCGCCATGGTTTGCTTCGAGCACCGTCCTTACCACCTTGTATAGGGAGAAAAGGAAGTGAACCCAGGACGAGCAAATTGACTAGACAAGCATCGCTTAACTCTTCGGATGTCTTGCCACCGCCACACAAGTCAAAGGGGATGATGAAGCAGCAATACAGCATGCAAAGGCATGCACCTCAAAGATTACCAAAAGCGATGAGCTTGAATACTCGATATCCTAGTCAAACTAAAATGACAAAGAGCCTGAGTGATCTGGAATGTGAAGAAGT\nJZ822578.1 contig2 cDNA library of flower petals in tree peony by suppression subtractive hybridization Paeonia suffruticosa cDNA, mRNA sequence\n\n\n\n\n\n\n\nCode\nfa.fetch('JZ822577.1', (1,6))\n\n\n'CTCTAG'\n\n\n\n\nCode\nfa.fetch('JZ822577.1', (1,6), strand = '-')\n\n\n'CTAGAG'"
  },
  {
    "objectID": "analysis/2024-06-22-GTEx-sqtl-enrich.html",
    "href": "analysis/2024-06-22-GTEx-sqtl-enrich.html",
    "title": "GTEx sQTL enrichment - updated (V2)",
    "section": "",
    "text": "The underlying data for both the qqplot and the scatter plot are the from this procedure:\n\nMap sQTLs using permutation pass with QTLtools against leafcutter2 output. Each phenotype is an intron.\nPermpass result report a top SNP for each intron. Use the collection of these top SNPs to subset genotype VCF file.\nRun nominal pass for eQTL with expression data and the subsetted genotype VCF file. This effectively run regression analysis of each top sQTL SNP against gene expression.\n\nThen for the qqplot, I plotted the pvalue of expression regression for each productive vs. unproductive sQTLs top SNP.\nFor the scatter plot, each top SNP is the top SNP of a productive or unprodutive sQTL. X axis is SNP’s regression slope for gene expression, and Y axis is the regression slope of splicing.\nNote each sQTL is either a productive or unproductive sQTLs, and represent a intron cluster. A productive sQTL is a cluster that only have productive introns. The strongest intron is chosen to represent the cluster (instead of aggregated of all the introns).\nAn unproductive sQTL is a cluster that has both productive intron and unproductive introns with permutation pass q value &lt; 0.1. The best intron (largest top SNP slope) is chosen to represent the cluster as unproductive sQTL. Note, comparing to previous version, here for u-sQTLs (ctype = PR,UP) select the best unproductive intron to represent the cluster.\n\nEnrichment of sQTL in eQTL pvalues\n\n\n\n\n\n\nNote\n\n\n\nY axis is flipped for eqtls with negative beta.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1\n\n\n\n\n\n\n\n\n\n\n\nFigure 2\n\n\n\n\n\n\n\n\n\n\n\nFigure 3\n\n\n\n\n\n\n\n\n\n\n\nFigure 4\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 5\n\n\n\n\n\n\n\n\n\n\n\nFigure 6\n\n\n\n\n\n\n\n\n\n\n\nFigure 7\n\n\n\n\n\n\n\n\n\n\n\nFigure 8\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 9\n\n\n\n\n\n\n\n\n\n\n\nFigure 10\n\n\n\n\n\n\n\n\n\n\n\nFigure 11\n\n\n\n\n\n\n\n\n\n\n\nFigure 12\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 13\n\n\n\n\n\n\n\n\n\n\n\nFigure 14\n\n\n\n\n\n\n\n\n\n\n\nFigure 15\n\n\n\n\n\n\n\n\n\n\n\nFigure 16\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 17\n\n\n\n\n\n\n\n\n\n\n\nFigure 18\n\n\n\n\n\n\n\n\n\n\n\nFigure 19\n\n\n\n\n\n\n\n\n\n\n\nFigure 20\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 21\n\n\n\n\n\n\n\n\n\n\n\nFigure 22\n\n\n\n\n\n\n\n\n\n\n\nFigure 23\n\n\n\n\n\n\n\n\n\n\n\nFigure 24\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 25\n\n\n\n\n\n\n\n\n\n\n\nFigure 26\n\n\n\n\n\n\n\n\n\n\n\nFigure 27\n\n\n\n\n\n\n\n\n\n\n\nFigure 28\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 29\n\n\n\n\n\n\n\n\n\n\n\nFigure 30\n\n\n\n\n\n\n\n\n\n\n\nFigure 31\n\n\n\n\n\n\n\n\n\n\n\nFigure 32\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 33\n\n\n\n\n\n\n\n\n\n\n\nFigure 34\n\n\n\n\n\n\n\n\n\n\n\nFigure 35\n\n\n\n\n\n\n\n\n\n\n\nFigure 36\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 37\n\n\n\n\n\n\n\n\n\n\n\nFigure 38\n\n\n\n\n\n\n\n\n\n\n\nFigure 39\n\n\n\n\n\n\n\n\n\n\n\nFigure 40\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 41\n\n\n\n\n\n\n\n\n\n\n\nFigure 42\n\n\n\n\n\n\n\n\n\n\n\nFigure 43\n\n\n\n\n\n\n\n\n\n\n\nFigure 44\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 45\n\n\n\n\n\n\n\n\n\n\n\nFigure 46\n\n\n\n\n\n\n\n\n\n\n\nFigure 47\n\n\n\n\n\n\n\n\n\n\n\nFigure 48\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 49\n\n\n\n\n\n\n\n\nComparison of sQTL (top SNP beta) and eQTL effect size (nominal beta of same top sQTL SNP)\n\n\n\n\n\n\nNote\n\n\n\nused pearson correlation.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 50: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 51: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 52: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 53: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 54: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 55: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 56: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 57: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 58: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 59: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 60: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 61: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 62: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 63: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 64: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 65: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 66: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 67: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 68: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 69: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 70: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 71: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 72: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 73: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 74: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 75: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 76: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 77: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 78: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 79: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 80: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 81: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 82: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 83: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 84: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 85: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 86: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 87: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 88: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 89: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 90: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 91: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 92: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 93: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 94: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 95: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 96: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 97: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 98: comparison of sQTL and eQTL effect size"
  },
  {
    "objectID": "analysis/2024-06-18-GTEx-DGE-vs-DS.html",
    "href": "analysis/2024-06-18-GTEx-DGE-vs-DS.html",
    "title": "Differential splicing vs differential gene expression in GTEx",
    "section": "",
    "text": "This notebook produces the comparison of differential splicing and differential gene expression. Pre-processed data are under ../../SpliFi/data/ds_v_dge/{tissue2}_v_{tissue1}_data.rds\n\n\n\n\nSaved RDS file is a list of 3 objects: - ds : differential splicing results - dge : differential gene expression results - dge_dsc : metadata for dge results\n\n\nCode\ncontrast &lt;- \"Brain-Cortex_v_Muscle-Skeletal\"\ndata &lt;- readRDS(glue('/project/yangili1/cdai/SpliFi/data/ds_v_dge/{contrast}_data.rds'))\n\nds &lt;- data$ds\ndge &lt;- data$dge\n\n\nds:\n\n\nCode\nhead(ds) %&gt;% gt::gt()\n\n\n\n\n\n\n\n\n\nintron\ncluster\nitype\nctype\ngene_name\ngene_id\nlogef\nMuscle-Skeletal\nBrain-Cortex\ndeltapsi\nstatus\nloglr\ndf\np\np.adjust\n\n\n\n\nchr1:930336:931038:clu_11_+\nchr1:clu_11_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n0.001370763\n0.5276685\n0.5283518\n0.0006832305\nSuccess\n0.0001028596\n1\n0.9885564\n0.9923067\n\n\nchr1:931089:935771:clu_11_+\nchr1:clu_11_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n-0.001370763\n0.4723315\n0.4716482\n-0.0006832305\nSuccess\n0.0001028596\n1\n0.9885564\n0.9923067\n\n\nchr1:939129:939271:clu_12_+\nchr1:clu_12_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n0.033612392\n0.3507898\n0.3662486\n0.0154587644\nSuccess\n0.0288890045\n1\n0.8100430\n0.8467780\n\n\nchr1:939129:939274:clu_12_+\nchr1:clu_12_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n-0.033612392\n0.6492102\n0.6337514\n-0.0154587644\nSuccess\n0.0288890045\n1\n0.8100430\n0.8467780\n\n\nchr1:939412:941143:clu_13_+\nchr1:clu_13_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n-0.022419411\n0.2376936\n0.2324409\n-0.0052526823\nSuccess\n1.3652655309\n2\n0.2553129\n0.3191507\n\n\nchr1:941306:942135:clu_13_+\nchr1:clu_13_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n-0.165432662\n0.4241880\n0.3595370\n-0.0646509809\nSuccess\n1.3652655309\n2\n0.2553129\n0.3191507\n\n\n\n\n\n\n\n\ndge:\n\n\nCode\nhead(dge) %&gt;% gt::gt()\n\n\n\n\n\n\n\n\n\ngene_id\nbaseMean\nlog2FoldChange\nlfcSE\nstat\npvalue\npadj\n\n\n\n\nENSG00000109061.9\n264709.904\n-13.54712\n0.2173014\n-62.34253\n0\n0\n\n\nENSG00000168530.15\n109266.143\n-13.36231\n0.1923248\n-69.47785\n0\n0\n\n\nENSG00000125414.18\n209656.455\n-13.35553\n0.2288908\n-58.34893\n0\n0\n\n\nENSG00000250978.5\n1478.281\n-13.28802\n0.3241620\n-40.99192\n0\n0\n\n\nENSG00000116748.21\n14974.113\n-13.21024\n0.2008433\n-65.77385\n0\n0\n\n\nENSG00000159173.18\n145207.909\n-13.10009\n0.2499607\n-52.40861\n0\n0\n\n\n\n\n\n\n\n\nCode\nprint(data$dge_dsc)\n\n\n[1] \"mean of normalized counts for all samples\"                     \n[2] \"log2 fold change (MLE): tissue Brain.Cortex vs Muscle.Skeletal\"\n[3] \"standard error: tissue Brain.Cortex vs Muscle.Skeletal\"        \n[4] \"Wald statistic: tissue Brain.Cortex vs Muscle.Skeletal\"        \n[5] \"Wald test p-value: tissue Brain.Cortex vs Muscle.Skeletal\"     \n[6] \"BH adjusted p-values\"                                          \n\n\n\n\n\nMainly to join ds and dge dataset on gene_id.\nIntrons from ds tables are selected using: - abs(deltapsi) &gt; .1 : to filter out introns with small deltaPSI - p.adjust &lt; FDR : to filter out introns with high FDR - ctype %in% c('PR', 'PR,UP') : introns are either productive or unproductive\n\n\nCode\ntissues &lt;- str_split(contrast, \"_v_\") %&gt;% unlist # follow tissue2_v_tissue1\n\n# confirm ds contrast\nconfirm_level_ds &lt;- all(names(data$ds)[c(9, 8)] == tissues)\n\n# confirm dge contrast\nconfirm_level_dge &lt;- str_detect(str_split(data$dge_dsc[2], \"tissue \")[[1]][[2]] %&gt;% str_replace_all(\"\\\\.\", \"-\"),\n                                glue(\"{tissues[1]} vs {tissues[2]}\")\n                                )\n\nif (confirm_level_dge & confirm_level_ds) {\n  message(\"Confirmed tissue order\")\n} else {\n  stop(\"Tissue order not confirmed\")\n}\n\n\nConfirmed tissue order\n\n\n\n\nCode\nFDR &lt;- params$fdr\n\nds[`p.adjust` &lt; FDR & ctype %in% c('PR', 'PR,UP')\n  ][,.(intron, deltapsi, itype)] %&gt;% unique %&gt;% \n  ggplot() + stat_ecdf(aes(x=abs(deltapsi), color=itype)) +\n    scale_color_brewer(type = \"qual\", palette = 2, direction = -1, label = c(PR=\"Productive\", UP=\"Unproductive\"), name = NULL) +\n    labs(title = glue(\"{contrast}\")) +\n    scale_x_sqrt(name = \"abs(deltaPSI)\")\n\n\n\n\n\n\n\n\nFigure 1: Distribution of deltaPSI in Brain-Cortex vs Muscle-Skeletal\n\n\n\n\n\nJoined ds and dge tables on gene_id.\n\n\nCode\njoined_dt &lt;- inner_join(\n  x = ds[abs(deltapsi) &gt; .1 & `p.adjust` &lt; FDR & ctype %in% c('PR', 'PR,UP'), \n        .(gene_id, gene_name, intron, cluster, itype, ctype, deltapsi)],\n  y = dge[, .(gene_id, g_l2fc = log2FoldChange, g_z = stat, g_l2fcSE = lfcSE)],\n  by = 'gene_id'\n  )\n\n\nQuick look of the joined table\n\n\nCode\njoined_dt %&gt;% head %&gt;% gt::gt()\n\n\n\n\n\n\n\n\n\ngene_id\ngene_name\nintron\ncluster\nitype\nctype\ndeltapsi\ng_l2fc\ng_z\ng_l2fcSE\n\n\n\n\nENSG00000188157.14\nAGRN\nchr1:1051815:1051992:clu_22_+\nchr1:clu_22_+\nPR\nPR\n0.4048714\n3.570754\n45.75627\n0.07803857\n\n\nENSG00000188157.14\nAGRN\nchr1:1051815:1053752:clu_22_+\nchr1:clu_22_+\nPR\nPR\n-0.3365948\n3.570754\n45.75627\n0.07803857\n\n\nENSG00000158286.12\nRNF207\nchr1:6212733:6213065:clu_111_+\nchr1:clu_111_+\nPR\nPR,UP\n-0.7185528\n1.907734\n16.39761\n0.11634224\n\n\nENSG00000158286.12\nRNF207\nchr1:6212903:6213065:clu_111_+\nchr1:clu_111_+\nUP\nPR,UP\n0.7185528\n1.907734\n16.39761\n0.11634224\n\n\nENSG00000171735.18\nCAMTA1\nchr1:7747781:7749770:clu_131_+\nchr1:clu_131_+\nPR\nPR\n0.3256170\n1.330244\n21.12208\n0.06297885\n\n\nENSG00000171735.18\nCAMTA1\nchr1:7747781:7751198:clu_131_+\nchr1:clu_131_+\nPR\nPR\n-0.6950003\n1.330244\n21.12208\n0.06297885\n\n\n\n\n\n\n\n\nCode\ndim(joined_dt)\n\n\n[1] 3603   10\n\n\nCode\njoined_dt[, .(Ngene = uniqueN(gene_id), Nintron = uniqueN(intron))]\n\n\n   Ngene Nintron\n1:  1650    3603\n\n\n\n\n\nCompute correlation between intron’s deltaPSI and gene’s log2FC\nNote for some reason quarto does not refresh the output of this cell, result is not correct!\n\n\nCode\ncor_res &lt;- joined_dt %&gt;% \n  split(by = 'itype') %&gt;% \n  map(~cor.test(x = .x$g_z, y = .x$deltapsi, method = 'p')) %&gt;% \n  imap_dfr(\n    \\(x, y) {\n      data.table(\n        cor = x$estimate,\n        p = x$`p.value`,\n        itype = y)\n    }\n  )\n\ncor_res \n\n\n           cor          p itype\n1:  0.02569642 0.14315331    PR\n2: -0.13544088 0.01062843    UP\n\n\n\n\n\n\n\nCode\njoined_dt %&gt;% \n  ggplot() +\n    geom_pointdensity(aes(g_z, deltapsi), size = .5, ) +\n    scale_color_viridis_c() + \n    geom_smooth(aes(g_z, deltapsi), method = \"lm\", formula = y~x, se = FALSE) +\n    labs(title = glue(\"{title}\", title = str_replace(contrast, \"_v_\", \" vs \")), \n         x = \"DGE: Log2FC (z)\",\n         y = \"deltaPSI\") +\n    facet_wrap(~itype, scales = \"free\")\n\n\n\n\n\n\n\n\nFigure 2: Correlation between deltaPSI and log2FC in Brain-Cortex vs Muscle-Skeletal\n\n\n\n\n\n\n\n\n\nHere, I try to compare the correlation between unproductive splicing and gene expression across all GTEx tissue pairs.\n\n\n\n\nCode\nread_contrast &lt;- function(rds, contrast, FDR = 1e-5, selection = 'all') {\n  #' @params rds: path to rds file'\n  #' @params contrast: contrast name'\n  #' @params FDR: FDR threshold'\n  #' @params selection: 'all', 'maxClu', 'maxGene'.\n  #'                    Select all introns, max deltaPSI per cluster, or max deltaPSI per gene'\n\n\n\n  data &lt;- readRDS(rds)\n  ds &lt;- data$ds\n  dge &lt;- data$dge\n  dge_dsc &lt;- data$dge_dsc\n\n  joined_dt &lt;- inner_join(\n    x = ds[abs(deltapsi) &gt; .1 & `p.adjust` &lt; FDR & ctype %in% c('PR', 'PR,UP'), \n          .(gene_id, gene_name, intron, cluster, itype, ctype, deltapsi)],\n    y = dge[, .(gene_id, g_l2fc = log2FoldChange, g_z = stat, g_l2fcSE = lfcSE)],\n    by = 'gene_id'\n  )\n\n  if (selection == 'maxClu') {\n    joined_dt  &lt;- joined_dt[\n      , .(intron, deltapsi, g_l2fc, g_z, g_l2fcSE, rk = rank(-abs(deltapsi), ties.method = \"random\")), \n      by = .(gene_id, gene_name, cluster, itype, ctype)\n      ][rk == 1, -c('rk')]\n  } else if (selection == 'maxGene') {\n    joined_dt &lt;- joined_dt[\n      , .(intron, deltapsi, g_l2fc, g_z, g_l2fcSE, rk = rank(-abs(deltapsi), ties.method = \"random\")), \n      by = .(gene_id, gene_name, itype)\n      ][rk == 1, -c('rk')]\n  }\n\n  # run cor.test\n  cor_res &lt;- joined_dt %&gt;% \n    split(by = 'itype') %&gt;% \n    map(~cor.test(x = .x$g_z, y = .x$deltapsi, method = 'pearson')) %&gt;% \n    imap_dfr(\n      \\(x, y) {\n        data.table(\n          cor = x$estimate,\n          p = x$`p.value`,\n          itype = y,\n          contrast = contrast)\n      }\n    )\n\n    # plot scatter plot\n    p  &lt;- joined_dt %&gt;% \n      ggplot() + \n        geom_pointdensity(aes(g_z, deltapsi), size = .5, alpha = .5) +\n        scale_color_viridis_c() + \n        geom_smooth(aes(g_z, deltapsi), method = \"lm\", formula = y~x, se = FALSE, color = 'blue', lwd = 1) +\n        geom_text(aes(x = 0,\n                      y = 0.1, \n                      label = paste(\"cor: \", round(cor, 3), \", \",\n                                    \"p. val: \", format(p, digits = 3, scientific = T), \n                                    sep = \"\")\n                      ),\n                  data = cor_res, color = 'blue', size = 4, vjust = 1) +\n        labs(x = \"DGE: Z-score\", y = \"DS: deltaPSI\", color = \"Num. points\", \n             title = str_wrap(str_replace_all(contrast, '_', ' '), width = 40)) +\n        facet_wrap(~itype)\n\n    return(list(cor_res = cor_res, gg = p, joineddf = joined_dt))\n\n}\n\n\nLoad contrast ds, dge data.\nrds file and contrast name example:\n\n\nCode\nrds_list &lt;- dir('/project/yangili1/cdai/SpliFi/data/ds_v_dge', full.names = T, pattern = '*.rds')\nrds_list &lt;- rds_list[str_detect(rds_list, \".+ds_v_dge.+_v_.+data.rds\")]\ncontrast_list &lt;- str_split(rds_list, \"/\") %&gt;% map(., last) %&gt;% unlist %&gt;% str_remove_all('_data\\\\.rds')\n\n\nhead(rds_list)\n\n\n[1] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_AdrenalGland_data.rds\"                       \n[2] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Artery-Coronary_data.rds\"                    \n[3] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Brain-Amygdala_data.rds\"                     \n[4] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Brain-Anteriorcingulatecortex_BA24__data.rds\"\n[5] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Brain-Caudate_basalganglia__data.rds\"        \n[6] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Brain-CerebellarHemisphere_data.rds\"         \n\n\nCode\nhead(contrast_list)\n\n\n[1] \"Adipose-Visceral_Omentum__v_AdrenalGland\"                       \n[2] \"Adipose-Visceral_Omentum__v_Artery-Coronary\"                    \n[3] \"Adipose-Visceral_Omentum__v_Brain-Amygdala\"                     \n[4] \"Adipose-Visceral_Omentum__v_Brain-Anteriorcingulatecortex_BA24_\"\n[5] \"Adipose-Visceral_Omentum__v_Brain-Caudate_basalganglia_\"        \n[6] \"Adipose-Visceral_Omentum__v_Brain-CerebellarHemisphere\"         \n\n\n\n\nCode\nFDR &lt;- params$fdr\n\n\nProcess all the contrast data using FDR=1e-5:\n\n\nCode\nres &lt;- map2(rds_list, contrast_list, read_contrast, FDR = 1e-5, selection = 'maxClu')\ndf &lt;- map_dfr(res, ~.x$cor_res)\n\n\n\n\nCode\nres3 &lt;- map2(rds_list, contrast_list, read_contrast, FDR = 1e-5, selection = 'all')\ndf3 &lt;- map_dfr(res3, ~.x[['cor_res']])\n\n\n\n\n\n\n\nCode\ngg3 &lt;- df3 %&gt;% \n  ggplot() + geom_pointdensity(aes(cor, -log10(p), color = itype), size = .5, alpha = .9) +\n  scale_color_brewer(type = \"qual\", \n                     palette = 1,\n                     direction = 1,\n                     label = c(PR=\"Productive\", UP=\"Unproductive\"),\n                     name = NULL) +\n  lims(x = c(-.5, .2), y = c(0, 30)) +\n  geom_hline(yintercept = -log10(0.001), linetype = 2) +\n    labs(title = 'Correlation between differential gene\\nexpression and diffferential splicing',\n         x = 'Correlation',\n         y = '-log10(p-value)'\n         )\ngg3\n\n\nWarning: Removed 3 rows containing non-finite values (`stat_pointdensity()`).\n\n\n\n\n\n\n\n\nFigure 3: Correlation between deltaPSI and expression log2FC for all GTEx tissue pairs\n\n\n\n\n\n\n\n\n\n\nCode\nid_to_plot &lt;- map_chr(res, ~.x$cor_res[, contrast] %&gt;% unique) %&gt;% \n  str_detect(., \"Brain-Cortex_v_Muscle-Skeletal\") %&gt;% \n  which\ngg &lt;- pluck(res, id_to_plot) %&gt;% pluck('gg')\ngg\n\n\n\n\n\n\n\n\nFigure 4: Correlation between deltaPSI and expression log2FC in Brain-Cortex vs Muscle-Skeletal"
  },
  {
    "objectID": "analysis/2024-06-18-GTEx-DGE-vs-DS.html#brain-cortex_v_muscle-skeletal",
    "href": "analysis/2024-06-18-GTEx-DGE-vs-DS.html#brain-cortex_v_muscle-skeletal",
    "title": "Differential splicing vs differential gene expression in GTEx",
    "section": "",
    "text": "Saved RDS file is a list of 3 objects: - ds : differential splicing results - dge : differential gene expression results - dge_dsc : metadata for dge results\n\n\nCode\ncontrast &lt;- \"Brain-Cortex_v_Muscle-Skeletal\"\ndata &lt;- readRDS(glue('/project/yangili1/cdai/SpliFi/data/ds_v_dge/{contrast}_data.rds'))\n\nds &lt;- data$ds\ndge &lt;- data$dge\n\n\nds:\n\n\nCode\nhead(ds) %&gt;% gt::gt()\n\n\n\n\n\n\n\n\n\nintron\ncluster\nitype\nctype\ngene_name\ngene_id\nlogef\nMuscle-Skeletal\nBrain-Cortex\ndeltapsi\nstatus\nloglr\ndf\np\np.adjust\n\n\n\n\nchr1:930336:931038:clu_11_+\nchr1:clu_11_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n0.001370763\n0.5276685\n0.5283518\n0.0006832305\nSuccess\n0.0001028596\n1\n0.9885564\n0.9923067\n\n\nchr1:931089:935771:clu_11_+\nchr1:clu_11_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n-0.001370763\n0.4723315\n0.4716482\n-0.0006832305\nSuccess\n0.0001028596\n1\n0.9885564\n0.9923067\n\n\nchr1:939129:939271:clu_12_+\nchr1:clu_12_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n0.033612392\n0.3507898\n0.3662486\n0.0154587644\nSuccess\n0.0288890045\n1\n0.8100430\n0.8467780\n\n\nchr1:939129:939274:clu_12_+\nchr1:clu_12_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n-0.033612392\n0.6492102\n0.6337514\n-0.0154587644\nSuccess\n0.0288890045\n1\n0.8100430\n0.8467780\n\n\nchr1:939412:941143:clu_13_+\nchr1:clu_13_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n-0.022419411\n0.2376936\n0.2324409\n-0.0052526823\nSuccess\n1.3652655309\n2\n0.2553129\n0.3191507\n\n\nchr1:941306:942135:clu_13_+\nchr1:clu_13_+\nPR\nPR\nSAMD11\nENSG00000187634.11\n-0.165432662\n0.4241880\n0.3595370\n-0.0646509809\nSuccess\n1.3652655309\n2\n0.2553129\n0.3191507\n\n\n\n\n\n\n\n\ndge:\n\n\nCode\nhead(dge) %&gt;% gt::gt()\n\n\n\n\n\n\n\n\n\ngene_id\nbaseMean\nlog2FoldChange\nlfcSE\nstat\npvalue\npadj\n\n\n\n\nENSG00000109061.9\n264709.904\n-13.54712\n0.2173014\n-62.34253\n0\n0\n\n\nENSG00000168530.15\n109266.143\n-13.36231\n0.1923248\n-69.47785\n0\n0\n\n\nENSG00000125414.18\n209656.455\n-13.35553\n0.2288908\n-58.34893\n0\n0\n\n\nENSG00000250978.5\n1478.281\n-13.28802\n0.3241620\n-40.99192\n0\n0\n\n\nENSG00000116748.21\n14974.113\n-13.21024\n0.2008433\n-65.77385\n0\n0\n\n\nENSG00000159173.18\n145207.909\n-13.10009\n0.2499607\n-52.40861\n0\n0\n\n\n\n\n\n\n\n\nCode\nprint(data$dge_dsc)\n\n\n[1] \"mean of normalized counts for all samples\"                     \n[2] \"log2 fold change (MLE): tissue Brain.Cortex vs Muscle.Skeletal\"\n[3] \"standard error: tissue Brain.Cortex vs Muscle.Skeletal\"        \n[4] \"Wald statistic: tissue Brain.Cortex vs Muscle.Skeletal\"        \n[5] \"Wald test p-value: tissue Brain.Cortex vs Muscle.Skeletal\"     \n[6] \"BH adjusted p-values\"                                          \n\n\n\n\n\nMainly to join ds and dge dataset on gene_id.\nIntrons from ds tables are selected using: - abs(deltapsi) &gt; .1 : to filter out introns with small deltaPSI - p.adjust &lt; FDR : to filter out introns with high FDR - ctype %in% c('PR', 'PR,UP') : introns are either productive or unproductive\n\n\nCode\ntissues &lt;- str_split(contrast, \"_v_\") %&gt;% unlist # follow tissue2_v_tissue1\n\n# confirm ds contrast\nconfirm_level_ds &lt;- all(names(data$ds)[c(9, 8)] == tissues)\n\n# confirm dge contrast\nconfirm_level_dge &lt;- str_detect(str_split(data$dge_dsc[2], \"tissue \")[[1]][[2]] %&gt;% str_replace_all(\"\\\\.\", \"-\"),\n                                glue(\"{tissues[1]} vs {tissues[2]}\")\n                                )\n\nif (confirm_level_dge & confirm_level_ds) {\n  message(\"Confirmed tissue order\")\n} else {\n  stop(\"Tissue order not confirmed\")\n}\n\n\nConfirmed tissue order\n\n\n\n\nCode\nFDR &lt;- params$fdr\n\nds[`p.adjust` &lt; FDR & ctype %in% c('PR', 'PR,UP')\n  ][,.(intron, deltapsi, itype)] %&gt;% unique %&gt;% \n  ggplot() + stat_ecdf(aes(x=abs(deltapsi), color=itype)) +\n    scale_color_brewer(type = \"qual\", palette = 2, direction = -1, label = c(PR=\"Productive\", UP=\"Unproductive\"), name = NULL) +\n    labs(title = glue(\"{contrast}\")) +\n    scale_x_sqrt(name = \"abs(deltaPSI)\")\n\n\n\n\n\n\n\n\nFigure 1: Distribution of deltaPSI in Brain-Cortex vs Muscle-Skeletal\n\n\n\n\n\nJoined ds and dge tables on gene_id.\n\n\nCode\njoined_dt &lt;- inner_join(\n  x = ds[abs(deltapsi) &gt; .1 & `p.adjust` &lt; FDR & ctype %in% c('PR', 'PR,UP'), \n        .(gene_id, gene_name, intron, cluster, itype, ctype, deltapsi)],\n  y = dge[, .(gene_id, g_l2fc = log2FoldChange, g_z = stat, g_l2fcSE = lfcSE)],\n  by = 'gene_id'\n  )\n\n\nQuick look of the joined table\n\n\nCode\njoined_dt %&gt;% head %&gt;% gt::gt()\n\n\n\n\n\n\n\n\n\ngene_id\ngene_name\nintron\ncluster\nitype\nctype\ndeltapsi\ng_l2fc\ng_z\ng_l2fcSE\n\n\n\n\nENSG00000188157.14\nAGRN\nchr1:1051815:1051992:clu_22_+\nchr1:clu_22_+\nPR\nPR\n0.4048714\n3.570754\n45.75627\n0.07803857\n\n\nENSG00000188157.14\nAGRN\nchr1:1051815:1053752:clu_22_+\nchr1:clu_22_+\nPR\nPR\n-0.3365948\n3.570754\n45.75627\n0.07803857\n\n\nENSG00000158286.12\nRNF207\nchr1:6212733:6213065:clu_111_+\nchr1:clu_111_+\nPR\nPR,UP\n-0.7185528\n1.907734\n16.39761\n0.11634224\n\n\nENSG00000158286.12\nRNF207\nchr1:6212903:6213065:clu_111_+\nchr1:clu_111_+\nUP\nPR,UP\n0.7185528\n1.907734\n16.39761\n0.11634224\n\n\nENSG00000171735.18\nCAMTA1\nchr1:7747781:7749770:clu_131_+\nchr1:clu_131_+\nPR\nPR\n0.3256170\n1.330244\n21.12208\n0.06297885\n\n\nENSG00000171735.18\nCAMTA1\nchr1:7747781:7751198:clu_131_+\nchr1:clu_131_+\nPR\nPR\n-0.6950003\n1.330244\n21.12208\n0.06297885\n\n\n\n\n\n\n\n\nCode\ndim(joined_dt)\n\n\n[1] 3603   10\n\n\nCode\njoined_dt[, .(Ngene = uniqueN(gene_id), Nintron = uniqueN(intron))]\n\n\n   Ngene Nintron\n1:  1650    3603\n\n\n\n\n\nCompute correlation between intron’s deltaPSI and gene’s log2FC\nNote for some reason quarto does not refresh the output of this cell, result is not correct!\n\n\nCode\ncor_res &lt;- joined_dt %&gt;% \n  split(by = 'itype') %&gt;% \n  map(~cor.test(x = .x$g_z, y = .x$deltapsi, method = 'p')) %&gt;% \n  imap_dfr(\n    \\(x, y) {\n      data.table(\n        cor = x$estimate,\n        p = x$`p.value`,\n        itype = y)\n    }\n  )\n\ncor_res \n\n\n           cor          p itype\n1:  0.02569642 0.14315331    PR\n2: -0.13544088 0.01062843    UP\n\n\n\n\n\n\n\nCode\njoined_dt %&gt;% \n  ggplot() +\n    geom_pointdensity(aes(g_z, deltapsi), size = .5, ) +\n    scale_color_viridis_c() + \n    geom_smooth(aes(g_z, deltapsi), method = \"lm\", formula = y~x, se = FALSE) +\n    labs(title = glue(\"{title}\", title = str_replace(contrast, \"_v_\", \" vs \")), \n         x = \"DGE: Log2FC (z)\",\n         y = \"deltaPSI\") +\n    facet_wrap(~itype, scales = \"free\")\n\n\n\n\n\n\n\n\nFigure 2: Correlation between deltaPSI and log2FC in Brain-Cortex vs Muscle-Skeletal"
  },
  {
    "objectID": "analysis/2024-06-18-GTEx-DGE-vs-DS.html#unproductive-splicing-vs.-expression-for-all-gtex-tissue-pairs",
    "href": "analysis/2024-06-18-GTEx-DGE-vs-DS.html#unproductive-splicing-vs.-expression-for-all-gtex-tissue-pairs",
    "title": "Differential splicing vs differential gene expression in GTEx",
    "section": "",
    "text": "Here, I try to compare the correlation between unproductive splicing and gene expression across all GTEx tissue pairs.\n\n\n\n\nCode\nread_contrast &lt;- function(rds, contrast, FDR = 1e-5, selection = 'all') {\n  #' @params rds: path to rds file'\n  #' @params contrast: contrast name'\n  #' @params FDR: FDR threshold'\n  #' @params selection: 'all', 'maxClu', 'maxGene'.\n  #'                    Select all introns, max deltaPSI per cluster, or max deltaPSI per gene'\n\n\n\n  data &lt;- readRDS(rds)\n  ds &lt;- data$ds\n  dge &lt;- data$dge\n  dge_dsc &lt;- data$dge_dsc\n\n  joined_dt &lt;- inner_join(\n    x = ds[abs(deltapsi) &gt; .1 & `p.adjust` &lt; FDR & ctype %in% c('PR', 'PR,UP'), \n          .(gene_id, gene_name, intron, cluster, itype, ctype, deltapsi)],\n    y = dge[, .(gene_id, g_l2fc = log2FoldChange, g_z = stat, g_l2fcSE = lfcSE)],\n    by = 'gene_id'\n  )\n\n  if (selection == 'maxClu') {\n    joined_dt  &lt;- joined_dt[\n      , .(intron, deltapsi, g_l2fc, g_z, g_l2fcSE, rk = rank(-abs(deltapsi), ties.method = \"random\")), \n      by = .(gene_id, gene_name, cluster, itype, ctype)\n      ][rk == 1, -c('rk')]\n  } else if (selection == 'maxGene') {\n    joined_dt &lt;- joined_dt[\n      , .(intron, deltapsi, g_l2fc, g_z, g_l2fcSE, rk = rank(-abs(deltapsi), ties.method = \"random\")), \n      by = .(gene_id, gene_name, itype)\n      ][rk == 1, -c('rk')]\n  }\n\n  # run cor.test\n  cor_res &lt;- joined_dt %&gt;% \n    split(by = 'itype') %&gt;% \n    map(~cor.test(x = .x$g_z, y = .x$deltapsi, method = 'pearson')) %&gt;% \n    imap_dfr(\n      \\(x, y) {\n        data.table(\n          cor = x$estimate,\n          p = x$`p.value`,\n          itype = y,\n          contrast = contrast)\n      }\n    )\n\n    # plot scatter plot\n    p  &lt;- joined_dt %&gt;% \n      ggplot() + \n        geom_pointdensity(aes(g_z, deltapsi), size = .5, alpha = .5) +\n        scale_color_viridis_c() + \n        geom_smooth(aes(g_z, deltapsi), method = \"lm\", formula = y~x, se = FALSE, color = 'blue', lwd = 1) +\n        geom_text(aes(x = 0,\n                      y = 0.1, \n                      label = paste(\"cor: \", round(cor, 3), \", \",\n                                    \"p. val: \", format(p, digits = 3, scientific = T), \n                                    sep = \"\")\n                      ),\n                  data = cor_res, color = 'blue', size = 4, vjust = 1) +\n        labs(x = \"DGE: Z-score\", y = \"DS: deltaPSI\", color = \"Num. points\", \n             title = str_wrap(str_replace_all(contrast, '_', ' '), width = 40)) +\n        facet_wrap(~itype)\n\n    return(list(cor_res = cor_res, gg = p, joineddf = joined_dt))\n\n}\n\n\nLoad contrast ds, dge data.\nrds file and contrast name example:\n\n\nCode\nrds_list &lt;- dir('/project/yangili1/cdai/SpliFi/data/ds_v_dge', full.names = T, pattern = '*.rds')\nrds_list &lt;- rds_list[str_detect(rds_list, \".+ds_v_dge.+_v_.+data.rds\")]\ncontrast_list &lt;- str_split(rds_list, \"/\") %&gt;% map(., last) %&gt;% unlist %&gt;% str_remove_all('_data\\\\.rds')\n\n\nhead(rds_list)\n\n\n[1] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_AdrenalGland_data.rds\"                       \n[2] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Artery-Coronary_data.rds\"                    \n[3] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Brain-Amygdala_data.rds\"                     \n[4] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Brain-Anteriorcingulatecortex_BA24__data.rds\"\n[5] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Brain-Caudate_basalganglia__data.rds\"        \n[6] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Adipose-Visceral_Omentum__v_Brain-CerebellarHemisphere_data.rds\"         \n\n\nCode\nhead(contrast_list)\n\n\n[1] \"Adipose-Visceral_Omentum__v_AdrenalGland\"                       \n[2] \"Adipose-Visceral_Omentum__v_Artery-Coronary\"                    \n[3] \"Adipose-Visceral_Omentum__v_Brain-Amygdala\"                     \n[4] \"Adipose-Visceral_Omentum__v_Brain-Anteriorcingulatecortex_BA24_\"\n[5] \"Adipose-Visceral_Omentum__v_Brain-Caudate_basalganglia_\"        \n[6] \"Adipose-Visceral_Omentum__v_Brain-CerebellarHemisphere\"         \n\n\n\n\nCode\nFDR &lt;- params$fdr\n\n\nProcess all the contrast data using FDR=1e-5:\n\n\nCode\nres &lt;- map2(rds_list, contrast_list, read_contrast, FDR = 1e-5, selection = 'maxClu')\ndf &lt;- map_dfr(res, ~.x$cor_res)\n\n\n\n\nCode\nres3 &lt;- map2(rds_list, contrast_list, read_contrast, FDR = 1e-5, selection = 'all')\ndf3 &lt;- map_dfr(res3, ~.x[['cor_res']])\n\n\n\n\n\n\n\nCode\ngg3 &lt;- df3 %&gt;% \n  ggplot() + geom_pointdensity(aes(cor, -log10(p), color = itype), size = .5, alpha = .9) +\n  scale_color_brewer(type = \"qual\", \n                     palette = 1,\n                     direction = 1,\n                     label = c(PR=\"Productive\", UP=\"Unproductive\"),\n                     name = NULL) +\n  lims(x = c(-.5, .2), y = c(0, 30)) +\n  geom_hline(yintercept = -log10(0.001), linetype = 2) +\n    labs(title = 'Correlation between differential gene\\nexpression and diffferential splicing',\n         x = 'Correlation',\n         y = '-log10(p-value)'\n         )\ngg3\n\n\nWarning: Removed 3 rows containing non-finite values (`stat_pointdensity()`).\n\n\n\n\n\n\n\n\nFigure 3: Correlation between deltaPSI and expression log2FC for all GTEx tissue pairs\n\n\n\n\n\n\n\n\n\n\nCode\nid_to_plot &lt;- map_chr(res, ~.x$cor_res[, contrast] %&gt;% unique) %&gt;% \n  str_detect(., \"Brain-Cortex_v_Muscle-Skeletal\") %&gt;% \n  which\ngg &lt;- pluck(res, id_to_plot) %&gt;% pluck('gg')\ngg\n\n\n\n\n\n\n\n\nFigure 4: Correlation between deltaPSI and expression log2FC in Brain-Cortex vs Muscle-Skeletal"
  },
  {
    "objectID": "analysis/2024-06-15-GWAS-list.html",
    "href": "analysis/2024-06-15-GWAS-list.html",
    "title": "GWAS list",
    "section": "",
    "text": "Code\ngwas_path1 &lt;- \"/project/yangili1/zpmu/GWAS_loci/trait_summary.txt\"\ngwas_summ1 &lt;- fread(gwas_path1)\n\n\nUsed 54 from the following path:\n\"/project/yangili1/zpmu/GWAS_loci\"\n\n\nCode\ngwas_summ1 %&gt;% gt::gt()\n\n\n\n\n\n\n\n\n\nTrait\nLabel\nPMID\n\n\n\n\nAllergy and eczema\nAE\n29892013\n\n\nMultiple sclerosis\nMS\n31604244\n\n\nRheumatoid arthritis\nRA\n24390342\n\n\nAllergic disases\nAllergy\n29083406\n\n\nAdult-onset Asthma\nAsthma\n30929738\n\n\nAptopic dermatitis\nApD\n26482879\n\n\nCrohns' disease\nIIBDGC - CD\n26192919\n\n\nInflammaroty bowel disease\nIIBDGC - IBD\n26192919\n\n\nUlcerative colitis\nIIBDGC - UC\n26192919\n\n\nSystemic lupus erythematosus\nSLE\n27399966\n\n\nAsthma\nTAGC - Asthma\n29273806\n\n\nCrohns' disease\nCD\n28067908\n\n\nInflammaroty bowel disease\nIBD\n28067908\n\n\nUlcerative colitis\nUC\n28067908\n\n\nBasophil count\nBASO#\n27863252\n\n\nBasophil percentage of white cells\nBASO%\n27863252\n\n\nBasophil percentage of granulocytes\nBASO%GRAN\n27863252\n\n\nSum basophil neutrophil count\n(BASO+NEUT)#\n27863252\n\n\nSum eosinophil basophil count\n(EO+BASO)#\n27863252\n\n\nEosinophil count\nEO#\n27863252\n\n\nEosinophil percentage of white cells\nEO%\n27863252\n\n\nEosinophil percentage of granulocytes\nEO%GRAN\n27863252\n\n\nGranulocyte count\nGRAN#\n27863252\n\n\nGranulocyte percentage of myeloid white cells\nGRAN%MYELOID\n27863252\n\n\nHematocrit\nHCT\n27863252\n\n\nHemoglobin concentration\nHGB\n27863252\n\n\nHigh light scatter percentage of red cells\nHLSR%\n27863252\n\n\nHigh light scatter reticulocyte count\nHLSR#\n27863252\n\n\nImmature fraction of reticulocytes\nIRF\n27863252\n\n\nLymphocyte count\nLYMPH#\n27863252\n\n\nLymphocyte percentage of white cells\nLYMPH%\n27863252\n\n\nMean corpuscular hemoglobin concentration\nMCHC\n27863252\n\n\nMean corpuscular hemoglobin\nMCH\n27863252\n\n\nMean corpuscular volume\nMCV\n27863252\n\n\nMonocyte count\nMONO#\n27863252\n\n\nMonocyte percentage of white cells\nMONO%\n27863252\n\n\nMean platelet volume\nMPV\n27863252\n\n\nMyeloid white cell count\nMYELOID#\n27863252\n\n\nSum neutrophil eosinophil count\n(NEUT+EO)#\n27863252\n\n\nNeutrophil percentage of granulocytes\nNEUT%GRAN\n27863252\n\n\nNeutrophil count\nNEUT#\n27863252\n\n\nNeutrophil percentage of white cells\nNEUT%\n27863252\n\n\nPlateletcrit\nPCT\n27863252\n\n\nPlatelet distribution width\nPDW\n27863252\n\n\nPlatelet count\nPLT#\n27863252\n\n\nRed blood cell count\nRBC#\n27863252\n\n\nRed cell distribution width\nRDW\n27863252\n\n\nReticulocyte count\nRET#\n27863252\n\n\nReticulocyte fraction of red cells\nRET%\n27863252\n\n\nWhite blood cell count\nWBC#\n27863252\n\n\nEstimated glomerular filtration rate\neGFR\n31152163\n\n\nType 2 diabetes\nT2D\n29632382\n\n\nParkinson's disease\nPD\n31701892\n\n\nAlzheimer's disease\nAD\n30617256"
  },
  {
    "objectID": "analysis/2024-06-15-GWAS-list.html#gwas-from-phenoix",
    "href": "analysis/2024-06-15-GWAS-list.html#gwas-from-phenoix",
    "title": "GWAS list",
    "section": "",
    "text": "Code\ngwas_path1 &lt;- \"/project/yangili1/zpmu/GWAS_loci/trait_summary.txt\"\ngwas_summ1 &lt;- fread(gwas_path1)\n\n\nUsed 54 from the following path:\n\"/project/yangili1/zpmu/GWAS_loci\"\n\n\nCode\ngwas_summ1 %&gt;% gt::gt()\n\n\n\n\n\n\n\n\n\nTrait\nLabel\nPMID\n\n\n\n\nAllergy and eczema\nAE\n29892013\n\n\nMultiple sclerosis\nMS\n31604244\n\n\nRheumatoid arthritis\nRA\n24390342\n\n\nAllergic disases\nAllergy\n29083406\n\n\nAdult-onset Asthma\nAsthma\n30929738\n\n\nAptopic dermatitis\nApD\n26482879\n\n\nCrohns' disease\nIIBDGC - CD\n26192919\n\n\nInflammaroty bowel disease\nIIBDGC - IBD\n26192919\n\n\nUlcerative colitis\nIIBDGC - UC\n26192919\n\n\nSystemic lupus erythematosus\nSLE\n27399966\n\n\nAsthma\nTAGC - Asthma\n29273806\n\n\nCrohns' disease\nCD\n28067908\n\n\nInflammaroty bowel disease\nIBD\n28067908\n\n\nUlcerative colitis\nUC\n28067908\n\n\nBasophil count\nBASO#\n27863252\n\n\nBasophil percentage of white cells\nBASO%\n27863252\n\n\nBasophil percentage of granulocytes\nBASO%GRAN\n27863252\n\n\nSum basophil neutrophil count\n(BASO+NEUT)#\n27863252\n\n\nSum eosinophil basophil count\n(EO+BASO)#\n27863252\n\n\nEosinophil count\nEO#\n27863252\n\n\nEosinophil percentage of white cells\nEO%\n27863252\n\n\nEosinophil percentage of granulocytes\nEO%GRAN\n27863252\n\n\nGranulocyte count\nGRAN#\n27863252\n\n\nGranulocyte percentage of myeloid white cells\nGRAN%MYELOID\n27863252\n\n\nHematocrit\nHCT\n27863252\n\n\nHemoglobin concentration\nHGB\n27863252\n\n\nHigh light scatter percentage of red cells\nHLSR%\n27863252\n\n\nHigh light scatter reticulocyte count\nHLSR#\n27863252\n\n\nImmature fraction of reticulocytes\nIRF\n27863252\n\n\nLymphocyte count\nLYMPH#\n27863252\n\n\nLymphocyte percentage of white cells\nLYMPH%\n27863252\n\n\nMean corpuscular hemoglobin concentration\nMCHC\n27863252\n\n\nMean corpuscular hemoglobin\nMCH\n27863252\n\n\nMean corpuscular volume\nMCV\n27863252\n\n\nMonocyte count\nMONO#\n27863252\n\n\nMonocyte percentage of white cells\nMONO%\n27863252\n\n\nMean platelet volume\nMPV\n27863252\n\n\nMyeloid white cell count\nMYELOID#\n27863252\n\n\nSum neutrophil eosinophil count\n(NEUT+EO)#\n27863252\n\n\nNeutrophil percentage of granulocytes\nNEUT%GRAN\n27863252\n\n\nNeutrophil count\nNEUT#\n27863252\n\n\nNeutrophil percentage of white cells\nNEUT%\n27863252\n\n\nPlateletcrit\nPCT\n27863252\n\n\nPlatelet distribution width\nPDW\n27863252\n\n\nPlatelet count\nPLT#\n27863252\n\n\nRed blood cell count\nRBC#\n27863252\n\n\nRed cell distribution width\nRDW\n27863252\n\n\nReticulocyte count\nRET#\n27863252\n\n\nReticulocyte fraction of red cells\nRET%\n27863252\n\n\nWhite blood cell count\nWBC#\n27863252\n\n\nEstimated glomerular filtration rate\neGFR\n31152163\n\n\nType 2 diabetes\nT2D\n29632382\n\n\nParkinson's disease\nPD\n31701892\n\n\nAlzheimer's disease\nAD\n30617256"
  },
  {
    "objectID": "analysis/2024-06-10-tally-sQTLs.html",
    "href": "analysis/2024-06-10-tally-sQTLs.html",
    "title": "QTL tally",
    "section": "",
    "text": "Code\nbase.geu &lt;- \"../code/results/qtl/noisy/Geuvadis/EUR/separateNoise/cis_100000/perm\"\ngeu.sql.f &lt;- glue(\"{base}/chr{chroms}.addQval.txt.gz\", base = base.geu, chroms = 1:22)\nnames(geu.sql.f) &lt;- glue(\"chr{1:22}\")\n\n\n\n\nCode\ngeu.sql &lt;- map_dfr(geu.sql.f, fread)\n\n\n\n\nCode\naddLabels &lt;- function(dt) {\n  pid_split &lt;- str_split(dt$phenotype_id, \":\")\n  dt$itype &lt;- map_chr(pid_split, ~ .x[5])\n  dt$clu &lt;- map_chr(pid_split, ~ .x[4])\n  dt$clu &lt;- str_extract(dt$clu, \"clu_[0-9]+\")\n\n  dt &lt;- dt[, ctype := paste(sort(unique(itype)), collapse = \",\"), by = clu][]\n  return(dt)\n}\n\n\n\n\nCode\ngeu.sql &lt;- addLabels(geu.sql)\n\n\n\n\nCode\ngeu.sql[1:2, ] %&gt;% DT::datatable()\n\n\n\n\n\n\n\n\nNumber of introns\n\n\nCode\ngeu.sql[, .N, by = itype\n  ][, .(itype, N, P = N/sum(N)  )\n  ][order(-N)]\n\n\n   itype     N          P\n1:    PR 83826 0.63891768\n2:    UP 29665 0.22610518\n3:    IN 11756 0.08960366\n4:    NE  5953 0.04537348\n\n\nNumber of clusters\n\n\nCode\ngeu.sql[, .(N = uniqueN(clu)), by = .(ctype)][, .(ctype, N, P = N/sum(N))][order(-N)]\n\n\n          ctype     N            P\n 1:          PR 21693 0.4992175634\n 2:       PR,UP 14598 0.3359414553\n 3:          IN  2943 0.0677267915\n 4:       NE,PR  2154 0.0495696599\n 5:    NE,PR,UP  1277 0.0293873982\n 6:          UP   488 0.0112302665\n 7:          NE    72 0.0016569246\n 8:    IN,PR,UP    53 0.0012196806\n 9:       IN,UP    43 0.0009895522\n10:       IN,PR    38 0.0008744880\n11:    IN,NE,PR    31 0.0007133981\n12: IN,NE,PR,UP    22 0.0005062825\n13:       IN,NE    20 0.0004602568\n14:       NE,UP    17 0.0003912183\n15:    IN,NE,UP     5 0.0001150642\n\n\n\n\n\nNumber of introns with FDR &lt; 0.1\n\n\nCode\nFDR = params$fdr\n\n\n\n\nCode\ngeu.sql[q &lt; FDR, .N, by = .(itype)][, .(itype, N, P = N/sum(N))][order(-N)]\n\n\n   itype    N          P\n1:    PR 9092 0.54777684\n2:    UP 3981 0.23984817\n3:    IN 2690 0.16206772\n4:    NE  835 0.05030727\n\n\nNumber of clusters with FDR &lt; 0.1\n\n\nCode\ngeu.sql[q &lt; FDR, .(N = uniqueN(clu)), by = .(ctype)][, .(ctype, N, P = N/sum(N))][order(-N)]\n\n\n          ctype    N            P\n 1:       PR,UP 3391 0.4070828331\n 2:          PR 2405 0.2887154862\n 3:          IN  971 0.1165666267\n 4:       NE,PR  700 0.0840336134\n 5:    NE,PR,UP  642 0.0770708283\n 6:          UP   86 0.0103241297\n 7:    IN,PR,UP   27 0.0032412965\n 8:       IN,PR   22 0.0026410564\n 9:    IN,NE,PR   21 0.0025210084\n10:       IN,UP   20 0.0024009604\n11: IN,NE,PR,UP   17 0.0020408163\n12:          NE   15 0.0018007203\n13:       IN,NE    8 0.0009603842\n14:       NE,UP    4 0.0004801921\n15:    IN,NE,UP    1 0.0001200480\n\n\n\n\n\nNumber of introns satisfying FDR &lt; 0.1 and from clusters of PR or PR,UP\n\n\nCode\ngeu.sql[q &lt; FDR & ctype %in% c(\"PR\", \"PR,UP\"), .N, by = .(itype)][, .(itype, N, P = N/sum(N))][order(-N)]\n\n\n   itype    N         P\n1:    PR 6960 0.6886998\n2:    UP 3146 0.3113002\n\n\nNumber of clusters satisfying FDR &lt; 0.1 and from clusters of PR or PR,UP\n\n\nCode\ngeu.sql[q &lt; FDR & ctype %in% c(\"PR\", \"PR,UP\"), .(N = uniqueN(clu)), by = .(ctype)][, .(ctype, N, P = N/sum(N))][order(-N)]\n\n\n   ctype    N         P\n1: PR,UP 3391 0.5850587\n2:    PR 2405 0.4149413\n\n\n\n\n\n\nFor GTEx, use sQTLs from 49 tissues. We use FDR &lt; 0.1 and cluster type PR or PR,UP to filter sQTLs.\n\n\nCode\nTissues &lt;- dir(\"../code/results/qtl/noisy/GTEx/\")\nTissues &lt;- Tissues[!Tissues %in% c(\"Bladder\")]\nnames(Tissues) &lt;- Tissues \nbase1.gtex &lt;- \"../code/results/qtl/noisy/GTEx\"\nbase2.gtex &lt;- \"/cis_100000/perm\"\nsuffix &lt;- \"addQval.txt.gz\"\n# \"../code/results/qtl/noisy/GTEx/Liver/separateNoise/cis_100000/perm/chr1.addQval.txt.gz\"\n\n\n\n\nCode\nreadGTExSQTL &lt;- function(tissue) {\n  base1.gtex &lt;- \"../code/results/qtl/noisy/GTEx/\"\n  base2.gtex &lt;- \"/cis_100000/perm\"\n  suffix &lt;- \"addQval.txt.gz\"\n  folder &lt;- glue(\"{base1.gtex}/{tissue}/separateNoise{base2.gtex}\")\n  files &lt;- glue(\"{folder}/chr{1:22}.{suffix}\")\n  dt &lt;- map_dfr(files, fread)\n}\n\n\n\n\nCode\ngtex.sqls &lt;- readRDS(\"2024-06-10-gtex-sQTLs.rds\")\n\n\n\n\nCode\ntissue.labels &lt;- fread(\"/project/yangili1/cdai/splice-pub/analysis/gtex-tissue-code.csv\",\n                      col.names = c(\"tissue\", \"label\"), header = F)\n\n\nNumber of introns that satisfy FDR &lt; 0.1 and from clusters of PR or PR,UP\n\n\nCode\ngtex.plot1.dt &lt;- imap_dfr(gtex.sqls, \\(x, y) {x[q &lt; FDR & ctype %in% c(\"PR\", \"PR,UP\"), .N, by = .(itype)][, .(tissue = y, itype, N, P = N/sum(N))][order(-N)]})\n\n\n\n\nCode\ngtex.plot1.dt %&gt;% \n  left_join(y = tissue.labels, by = \"tissue\") %&gt;% \n  ggplot() + geom_col(aes(x = forcats::fct_reorder(label, -N), y = N, fill = itype)) +\n    scale_fill_brewer(palette = \"Blues\", direction = 1) +\n    labs(x = NULL, y = \"Num. of sQTL introns\", fill = NULL) + \n    theme_cowplot() +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1),\n          legend.position = \"top\"\n         )\n\n\n\n\n\n\n\n\nFigure 1\n\n\n\n\n\n\n\nCode\ngtex.plot1.dt %&gt;% DT::datatable()\n\n\n\n\nTable 1\n\n\n\n\n\n\n\n\n\n\nNumber of clusters that satisfy FDR &lt; 0.1 and from clusters of PR or PR,UP\n\n\nCode\ngtex.plot2.dt &lt;- imap_dfr(gtex.sqls, \\(x, y) {\n  x[q &lt; FDR & ctype %in% c(\"PR\", \"PR,UP\"), .(N = uniqueN(clu)), by = .(ctype)][, .(tissue = y, ctype, N, P = N/sum(N))][order(-N)]\n}\n)\n\n\n\n\nCode\ngtex.plot2.dt %&gt;% \n  left_join(y = tissue.labels, by = \"tissue\") %&gt;% \n  ggplot() + geom_col(aes(x = forcats::fct_reorder(label, -N), y = N, fill = ctype)) +\n    scale_fill_brewer(palette = \"Blues\", direction = 1) +\n    labs(x = NULL, y = \"Num. of sQTL (cluster)\", fill = NULL) + \n    theme_cowplot() +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1),\n          legend.position = \"top\"\n         )\n\n\n\n\n\n\n\n\nFigure 2\n\n\n\n\n\n\n\nCode\ngtex.plot2.dt %&gt;% DT::datatable()\n\n\n\n\nTable 2"
  },
  {
    "objectID": "analysis/2024-06-10-tally-sQTLs.html#geuvaids-eur",
    "href": "analysis/2024-06-10-tally-sQTLs.html#geuvaids-eur",
    "title": "QTL tally",
    "section": "",
    "text": "Code\nbase.geu &lt;- \"../code/results/qtl/noisy/Geuvadis/EUR/separateNoise/cis_100000/perm\"\ngeu.sql.f &lt;- glue(\"{base}/chr{chroms}.addQval.txt.gz\", base = base.geu, chroms = 1:22)\nnames(geu.sql.f) &lt;- glue(\"chr{1:22}\")\n\n\n\n\nCode\ngeu.sql &lt;- map_dfr(geu.sql.f, fread)\n\n\n\n\nCode\naddLabels &lt;- function(dt) {\n  pid_split &lt;- str_split(dt$phenotype_id, \":\")\n  dt$itype &lt;- map_chr(pid_split, ~ .x[5])\n  dt$clu &lt;- map_chr(pid_split, ~ .x[4])\n  dt$clu &lt;- str_extract(dt$clu, \"clu_[0-9]+\")\n\n  dt &lt;- dt[, ctype := paste(sort(unique(itype)), collapse = \",\"), by = clu][]\n  return(dt)\n}\n\n\n\n\nCode\ngeu.sql &lt;- addLabels(geu.sql)\n\n\n\n\nCode\ngeu.sql[1:2, ] %&gt;% DT::datatable()\n\n\n\n\n\n\n\n\nNumber of introns\n\n\nCode\ngeu.sql[, .N, by = itype\n  ][, .(itype, N, P = N/sum(N)  )\n  ][order(-N)]\n\n\n   itype     N          P\n1:    PR 83826 0.63891768\n2:    UP 29665 0.22610518\n3:    IN 11756 0.08960366\n4:    NE  5953 0.04537348\n\n\nNumber of clusters\n\n\nCode\ngeu.sql[, .(N = uniqueN(clu)), by = .(ctype)][, .(ctype, N, P = N/sum(N))][order(-N)]\n\n\n          ctype     N            P\n 1:          PR 21693 0.4992175634\n 2:       PR,UP 14598 0.3359414553\n 3:          IN  2943 0.0677267915\n 4:       NE,PR  2154 0.0495696599\n 5:    NE,PR,UP  1277 0.0293873982\n 6:          UP   488 0.0112302665\n 7:          NE    72 0.0016569246\n 8:    IN,PR,UP    53 0.0012196806\n 9:       IN,UP    43 0.0009895522\n10:       IN,PR    38 0.0008744880\n11:    IN,NE,PR    31 0.0007133981\n12: IN,NE,PR,UP    22 0.0005062825\n13:       IN,NE    20 0.0004602568\n14:       NE,UP    17 0.0003912183\n15:    IN,NE,UP     5 0.0001150642\n\n\n\n\n\nNumber of introns with FDR &lt; 0.1\n\n\nCode\nFDR = params$fdr\n\n\n\n\nCode\ngeu.sql[q &lt; FDR, .N, by = .(itype)][, .(itype, N, P = N/sum(N))][order(-N)]\n\n\n   itype    N          P\n1:    PR 9092 0.54777684\n2:    UP 3981 0.23984817\n3:    IN 2690 0.16206772\n4:    NE  835 0.05030727\n\n\nNumber of clusters with FDR &lt; 0.1\n\n\nCode\ngeu.sql[q &lt; FDR, .(N = uniqueN(clu)), by = .(ctype)][, .(ctype, N, P = N/sum(N))][order(-N)]\n\n\n          ctype    N            P\n 1:       PR,UP 3391 0.4070828331\n 2:          PR 2405 0.2887154862\n 3:          IN  971 0.1165666267\n 4:       NE,PR  700 0.0840336134\n 5:    NE,PR,UP  642 0.0770708283\n 6:          UP   86 0.0103241297\n 7:    IN,PR,UP   27 0.0032412965\n 8:       IN,PR   22 0.0026410564\n 9:    IN,NE,PR   21 0.0025210084\n10:       IN,UP   20 0.0024009604\n11: IN,NE,PR,UP   17 0.0020408163\n12:          NE   15 0.0018007203\n13:       IN,NE    8 0.0009603842\n14:       NE,UP    4 0.0004801921\n15:    IN,NE,UP    1 0.0001200480\n\n\n\n\n\nNumber of introns satisfying FDR &lt; 0.1 and from clusters of PR or PR,UP\n\n\nCode\ngeu.sql[q &lt; FDR & ctype %in% c(\"PR\", \"PR,UP\"), .N, by = .(itype)][, .(itype, N, P = N/sum(N))][order(-N)]\n\n\n   itype    N         P\n1:    PR 6960 0.6886998\n2:    UP 3146 0.3113002\n\n\nNumber of clusters satisfying FDR &lt; 0.1 and from clusters of PR or PR,UP\n\n\nCode\ngeu.sql[q &lt; FDR & ctype %in% c(\"PR\", \"PR,UP\"), .(N = uniqueN(clu)), by = .(ctype)][, .(ctype, N, P = N/sum(N))][order(-N)]\n\n\n   ctype    N         P\n1: PR,UP 3391 0.5850587\n2:    PR 2405 0.4149413"
  },
  {
    "objectID": "analysis/2024-06-10-tally-sQTLs.html#gtex",
    "href": "analysis/2024-06-10-tally-sQTLs.html#gtex",
    "title": "QTL tally",
    "section": "",
    "text": "For GTEx, use sQTLs from 49 tissues. We use FDR &lt; 0.1 and cluster type PR or PR,UP to filter sQTLs.\n\n\nCode\nTissues &lt;- dir(\"../code/results/qtl/noisy/GTEx/\")\nTissues &lt;- Tissues[!Tissues %in% c(\"Bladder\")]\nnames(Tissues) &lt;- Tissues \nbase1.gtex &lt;- \"../code/results/qtl/noisy/GTEx\"\nbase2.gtex &lt;- \"/cis_100000/perm\"\nsuffix &lt;- \"addQval.txt.gz\"\n# \"../code/results/qtl/noisy/GTEx/Liver/separateNoise/cis_100000/perm/chr1.addQval.txt.gz\"\n\n\n\n\nCode\nreadGTExSQTL &lt;- function(tissue) {\n  base1.gtex &lt;- \"../code/results/qtl/noisy/GTEx/\"\n  base2.gtex &lt;- \"/cis_100000/perm\"\n  suffix &lt;- \"addQval.txt.gz\"\n  folder &lt;- glue(\"{base1.gtex}/{tissue}/separateNoise{base2.gtex}\")\n  files &lt;- glue(\"{folder}/chr{1:22}.{suffix}\")\n  dt &lt;- map_dfr(files, fread)\n}\n\n\n\n\nCode\ngtex.sqls &lt;- readRDS(\"2024-06-10-gtex-sQTLs.rds\")\n\n\n\n\nCode\ntissue.labels &lt;- fread(\"/project/yangili1/cdai/splice-pub/analysis/gtex-tissue-code.csv\",\n                      col.names = c(\"tissue\", \"label\"), header = F)\n\n\nNumber of introns that satisfy FDR &lt; 0.1 and from clusters of PR or PR,UP\n\n\nCode\ngtex.plot1.dt &lt;- imap_dfr(gtex.sqls, \\(x, y) {x[q &lt; FDR & ctype %in% c(\"PR\", \"PR,UP\"), .N, by = .(itype)][, .(tissue = y, itype, N, P = N/sum(N))][order(-N)]})\n\n\n\n\nCode\ngtex.plot1.dt %&gt;% \n  left_join(y = tissue.labels, by = \"tissue\") %&gt;% \n  ggplot() + geom_col(aes(x = forcats::fct_reorder(label, -N), y = N, fill = itype)) +\n    scale_fill_brewer(palette = \"Blues\", direction = 1) +\n    labs(x = NULL, y = \"Num. of sQTL introns\", fill = NULL) + \n    theme_cowplot() +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1),\n          legend.position = \"top\"\n         )\n\n\n\n\n\n\n\n\nFigure 1\n\n\n\n\n\n\n\nCode\ngtex.plot1.dt %&gt;% DT::datatable()\n\n\n\n\nTable 1\n\n\n\n\n\n\n\n\n\n\nNumber of clusters that satisfy FDR &lt; 0.1 and from clusters of PR or PR,UP\n\n\nCode\ngtex.plot2.dt &lt;- imap_dfr(gtex.sqls, \\(x, y) {\n  x[q &lt; FDR & ctype %in% c(\"PR\", \"PR,UP\"), .(N = uniqueN(clu)), by = .(ctype)][, .(tissue = y, ctype, N, P = N/sum(N))][order(-N)]\n}\n)\n\n\n\n\nCode\ngtex.plot2.dt %&gt;% \n  left_join(y = tissue.labels, by = \"tissue\") %&gt;% \n  ggplot() + geom_col(aes(x = forcats::fct_reorder(label, -N), y = N, fill = ctype)) +\n    scale_fill_brewer(palette = \"Blues\", direction = 1) +\n    labs(x = NULL, y = \"Num. of sQTL (cluster)\", fill = NULL) + \n    theme_cowplot() +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1),\n          legend.position = \"top\"\n         )\n\n\n\n\n\n\n\n\nFigure 2\n\n\n\n\n\n\n\nCode\ngtex.plot2.dt %&gt;% DT::datatable()\n\n\n\n\nTable 2"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "Analysis. Data path in SpliFi/code"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Unproductive Splicing",
    "section": "",
    "text": "Order By\n       Default\n         \n          Date - Oldest\n        \n         \n          Date - Newest\n        \n         \n          Title\n        \n         \n          Author\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\nDate\n\n\nTitle\n\n\nAuthor\n\n\n\n\n\n\nAug 15, 2024\n\n\nGTEx sQTL enrichment - updated (V4) - different pseudocount\n\n\n \n\n\n\n\nAug 7, 2024\n\n\ncoloc with GWAS and sQTL\n\n\n \n\n\n\n\nAug 6, 2024\n\n\nProcess GWAS summary stats\n\n\n \n\n\n\n\nAug 5, 2024\n\n\neQTL sQTL coloc with HyprColoc tally\n\n\n \n\n\n\n\nJul 25, 2024\n\n\nPlot heatmap of effect size correlation between eQTL and sQTL\n\n\n \n\n\n\n\nJul 16, 2024\n\n\nCheck sqtl beta beta corr plot - LCL\n\n\n \n\n\n\n\nJul 16, 2024\n\n\nCheck sqtl beta beta corr plot - Liver\n\n\n \n\n\n\n\nJul 16, 2024\n\n\nCheck sqtl beta beta corr plot\n\n\n \n\n\n\n\nJul 16, 2024\n\n\nsQTL procedure\n\n\n \n\n\n\n\nJul 15, 2024\n\n\nTORUS input prep\n\n\n \n\n\n\n\nJul 11, 2024\n\n\nGTEx sQTL enrichment - updated (V4)\n\n\n \n\n\n\n\nJul 10, 2024\n\n\nGTEx sQTL enrichment - updated (V3)\n\n\n \n\n\n\n\nJun 28, 2024\n\n\noff by 1 bug\n\n\n \n\n\n\n\nJun 25, 2024\n\n\nShould leafcutter 2 be using 1 or 0 based coordinates?\n\n\n \n\n\n\n\nJun 22, 2024\n\n\nGTEx sQTL enrichment - updated (V2)\n\n\n \n\n\n\n\nJun 20, 2024\n\n\nDifferential splicing vs differential gene expression in Selected Tissue pairs\n\n\n \n\n\n\n\nJun 18, 2024\n\n\nDifferential splicing vs differential gene expression in GTEx\n\n\n \n\n\n\n\nJun 17, 2024\n\n\nUnproductive splicing ratio in GTEx across tissues\n\n\n \n\n\n\n\nJun 15, 2024\n\n\nGTEx sQTL enrichment\n\n\n \n\n\n\n\nJun 15, 2024\n\n\nGWAS list\n\n\n \n\n\n\n\nJun 10, 2024\n\n\nGenome Tracks\n\n\n \n\n\n\n\nJun 10, 2024\n\n\nQTL tally\n\n\n \n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "analysis/2024-06-10-GenomeTracks.html",
    "href": "analysis/2024-06-10-GenomeTracks.html",
    "title": "Genome Tracks",
    "section": "",
    "text": "Intro"
  },
  {
    "objectID": "analysis/2024-06-15-GTEx-sqtl-enrich.html",
    "href": "analysis/2024-06-15-GTEx-sqtl-enrich.html",
    "title": "GTEx sQTL enrichment",
    "section": "",
    "text": "The underlying data for both the qqplot and the scatter plot are the from this procedure:\n\nMap sQTLs using permutation pass with QTLtools against leafcutter2 output. Each phenotype is an intron.\nPermpass result report a top SNP for each intron. Use the collection of these top SNPs to subset genotype VCF file.\nRun nominal pass for eQTL with expression data and the subsetted genotype VCF file. This effectively run regression analysis of each top sQTL SNP against gene expression.\n\nThen for the qqplot, I plotted the pvalue of expression regression for each productive vs. unproductive sQTLs top SNP.\nFor the scatter plot, each top SNP is the top SNP of a productive or unprodutive sQTL. X axis is SNP’s regression slope for gene expression, and Y axis is the regression slope of splicing.\nNote each sQTL is either a productive or unproductive sQTLs, and represent a intron cluster. A productive sQTL is a cluster that only have productive introns. The strongest intron is chosen to represent the cluster (instead of aggregated of all the introns).\nAn unproductive sQTL is a cluster that has both productive intron and unproductive introns with permutation pass q value &lt; 0.1. The best intron (largest top SNP slope) is chosen to represent the cluster as unproductive sQTL. Note even though the cluster is labeld as unproductive sQTL, either a productive or an unproductive intron is chosen to represent the cluster. For this reason, it may be a bit confliciting in the correlation plot.\n\nEnrichment of sQTL in eQTL pvalues\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1\n\n\n\n\n\n\n\n\n\n\n\nFigure 2\n\n\n\n\n\n\n\n\n\n\n\nFigure 3\n\n\n\n\n\n\n\n\n\n\n\nFigure 4\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 5\n\n\n\n\n\n\n\n\n\n\n\nFigure 6\n\n\n\n\n\n\n\n\n\n\n\nFigure 7\n\n\n\n\n\n\n\n\n\n\n\nFigure 8\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 9\n\n\n\n\n\n\n\n\n\n\n\nFigure 10\n\n\n\n\n\n\n\n\n\n\n\nFigure 11\n\n\n\n\n\n\n\n\n\n\n\nFigure 12\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 13\n\n\n\n\n\n\n\n\n\n\n\nFigure 14\n\n\n\n\n\n\n\n\n\n\n\nFigure 15\n\n\n\n\n\n\n\n\n\n\n\nFigure 16\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 17\n\n\n\n\n\n\n\n\n\n\n\nFigure 18\n\n\n\n\n\n\n\n\n\n\n\nFigure 19\n\n\n\n\n\n\n\n\n\n\n\nFigure 20\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 21\n\n\n\n\n\n\n\n\n\n\n\nFigure 22\n\n\n\n\n\n\n\n\n\n\n\nFigure 23\n\n\n\n\n\n\n\n\n\n\n\nFigure 24\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 25\n\n\n\n\n\n\n\n\n\n\n\nFigure 26\n\n\n\n\n\n\n\n\n\n\n\nFigure 27\n\n\n\n\n\n\n\n\n\n\n\nFigure 28\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 29\n\n\n\n\n\n\n\n\n\n\n\nFigure 30\n\n\n\n\n\n\n\n\n\n\n\nFigure 31\n\n\n\n\n\n\n\n\n\n\n\nFigure 32\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 33\n\n\n\n\n\n\n\n\n\n\n\nFigure 34\n\n\n\n\n\n\n\n\n\n\n\nFigure 35\n\n\n\n\n\n\n\n\n\n\n\nFigure 36\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 37\n\n\n\n\n\n\n\n\n\n\n\nFigure 38\n\n\n\n\n\n\n\n\n\n\n\nFigure 39\n\n\n\n\n\n\n\n\n\n\n\nFigure 40\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 41\n\n\n\n\n\n\n\n\n\n\n\nFigure 42\n\n\n\n\n\n\n\n\n\n\n\nFigure 43\n\n\n\n\n\n\n\n\n\n\n\nFigure 44\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 45\n\n\n\n\n\n\n\n\n\n\n\nFigure 46\n\n\n\n\n\n\n\n\n\n\n\nFigure 47\n\n\n\n\n\n\n\n\n\n\n\nFigure 48\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 49\n\n\n\n\n\n\n\n\nComparison of sQTL (top SNP beta) and eQTL effect size (nominal beta of same top sQTL SNP)\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 50: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 51: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 52: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 53: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 54: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 55: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 56: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 57: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 58: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 59: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 60: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 61: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 62: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 63: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 64: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 65: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 66: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 67: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 68: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 69: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 70: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 71: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 72: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 73: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 74: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 75: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 76: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 77: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 78: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 79: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 80: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 81: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 82: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 83: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 84: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 85: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 86: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 87: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 88: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 89: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 90: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 91: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 92: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 93: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 94: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 95: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 96: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 97: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 98: comparison of sQTL and eQTL effect size"
  },
  {
    "objectID": "analysis/2024-06-17-unprod-splicing-ratio-GTEx.html",
    "href": "analysis/2024-06-17-unprod-splicing-ratio-GTEx.html",
    "title": "Unproductive splicing ratio in GTEx across tissues",
    "section": "",
    "text": "Code\ntissues &lt;- dir(\"/project/yangili1/cdai/SpliFi/code/results/pheno/noisy/GTEx\")\ntissues &lt;- tissues[!str_detect(tissues, \"Bladder\")]\n\n\n\n\nCode\ncomputeUnprodRatio &lt;- function(tissue_rds) {\n\n    introns &lt;- readRDS(tissue_rds)\n    datacols &lt;- names(introns)[5:ncol(introns)]\n    # remove clu_type == N, clusters with only unproductive introns\n    introns  &lt;- introns[str_detect(clu_type, 'PR')]\n    # total reads (by sample)\n    totals &lt;- colSums(introns[, ..datacols])\n    # unproudctive reads (by sample)\n    unprod &lt;- introns[intron_type == 'UP', ..datacols] %&gt;% colSums\n    # unproductive reads / total reads\n    if (all(names(totals) == names(unprod))) {\n        unprod_ratio &lt;- round(unprod / totals, 5)\n    } else {\n        stop('samples of totals and unprod are not the same')\n    }\n\n    return(unprod_ratio)\n\n}\n\n\npoint_scale &lt;- function(x, newmin, newmax) {\n  newmax  &lt;- max(newmax)\n  newmin  &lt;- min(newmin)\n  new_range &lt;- abs(newmax - newmin) \n  old_range &lt;- abs(max(x) - min(x))\n\n  # Normalize the values between 0 and 1\n  normalized_x &lt;- (x - min(x)) / old_range\n\n  # Scale the normalized values to the new range and offset by 0.5\n  scaled_x &lt;- normalized_x * new_range + newmin\n\n  return(scaled_x)\n}\n\n\n\n\nCode\ntissues_rds &lt;- glue(\"/project/yangili1/cdai/SpliFi/data/ExtractFractions/GTEx/{tissues}.numerators_constcounts.noise_by_intron.rds\")\nnames(tissues_rds) &lt;- tissues\n\n\n\n\nCode\nratios &lt;- map(tissues_rds, computeUnprodRatio)\n\n\n\n\nCode\nratios &lt;- imap_dfr(\n    ratios,\n    \\(x, y) enframe(x, \"sample\", \"unprodRatio\") %&gt;% add_column(tissue = y)\n)\nratios  &lt;- as.data.table(ratios) %&gt;%\n    .[, .(sample, unprodRatio, nsample = uniqueN(sample)), by = tissue]\n\n\n\n\nCode\nratios[, .(median_prod_ratio = median(unprodRatio)), by = tissue][order(-median_prod_ratio)]\n\n\n                                  tissue median_prod_ratio\n 1:                               Testis          0.009140\n 2:                     Brain-Cerebellum          0.007230\n 3:           Brain-CerebellarHemisphere          0.006740\n 4:        Brain-Spinalcord_cervicalc-1_          0.006150\n 5:                              Thyroid          0.005650\n 6:                             Prostate          0.005630\n 7:                         Nerve-Tibial          0.005360\n 8:                               Spleen          0.005230\n 9:                            Pituitary          0.004970\n10:                Brain-Substantianigra          0.004820\n11:                                Ovary          0.004780\n12:                                 Lung          0.004705\n13:                        Kidney-Cortex          0.004650\n14:                    Brain-Hippocampus          0.004630\n15:         SmallIntestine-TerminalIleum          0.004630\n16:                 Breast-MammaryTissue          0.004540\n17:                               Uterus          0.004515\n18:                   Brain-Hypothalamus          0.004450\n19:       Skin-NotSunExposed_Suprapubic_          0.004310\n20:                         Brain-Cortex          0.004290\n21:                               Vagina          0.004290\n22:                 Adipose-Subcutaneous          0.004220\n23:                       Brain-Amygdala          0.004160\n24:          Brain-Putamen_basalganglia_          0.004150\n25:            Skin-SunExposed_Lowerleg_          0.004140\n26:                        Colon-Sigmoid          0.004110\n27:          Brain-Caudate_basalganglia_          0.004070\n28: Brain-Nucleusaccumbens_basalganglia_          0.004065\n29:            Adipose-Visceral_Omentum_          0.004010\n30:                     Colon-Transverse          0.003955\n31:   Esophagus-GastroesophagealJunction          0.003910\n32:  Brain-Anteriorcingulatecortex_BA24_          0.003890\n33:             Brain-FrontalCortex_BA9_          0.003820\n34:                           WholeBlood          0.003730\n35:                   MinorSalivaryGland          0.003705\n36:                 Esophagus-Muscularis          0.003690\n37:                        Artery-Tibial          0.003570\n38:                      Artery-Coronary          0.003520\n39:                              Stomach          0.003450\n40:                         Artery-Aorta          0.003440\n41:                         AdrenalGland          0.003435\n42:                Heart-AtrialAppendage          0.003400\n43:                                Liver          0.003160\n44:     Cells-EBV-transformedlymphocytes          0.003110\n45:                     Esophagus-Mucosa          0.002960\n46:                  Heart-LeftVentricle          0.002650\n47:                             Pancreas          0.002460\n48:                      Muscle-Skeletal          0.002450\n49:            Cells-Culturedfibroblasts          0.001860\n                                  tissue median_prod_ratio\n\n\nCode\nmedian_unprod_ratio_all_gtex &lt;- ratios[tissue != \"EUR\", .(median_prod_ratio = median(unprodRatio)), by = tissue\n    ][order(-median_prod_ratio)] %&gt;% \n    pull(median_prod_ratio) %&gt;% median\n\n\n\n\nCode\ntissue.labels &lt;- fread(\"/project/yangili1/cdai/splice-pub/analysis/gtex-tissue-code.csv\",\n                       header = F, col.names = c(\"tissue\", \"label\"))\n\n\n\n\nCode\ndf &lt;- ratios[, .(sample, unprodRatio, nsample, med = median(unprodRatio),rk=rank(unprodRatio, ties.method = \"first\")), by = tissue\n        ][, .(sample, unprodRatio, nsample, med, tissue = forcats::fct_reorder(tissue, -med), rk)\n        ][, .(sample, tissue, unprodRatio, nsample, med, tissuei = as.integer(tissue), rk)\n        ][, .(sample, unprodRatio, nsample, med, tissuei, rk, pointx = point_scale(rk, (tissuei - .5), tissuei+.5)), by = tissue\n        ][order(tissuei, rk)] %&gt;% \n    left_join(y = tissue.labels, by = \"tissue\")\n\n\n\n\nCode\nlabels  &lt;- df[, .(tissue, label, tissuei, nsample)] %&gt;% unique\nlabels\n\n\n                                  tissue   label tissuei nsample\n 1:                               Testis  TESTIS       1     361\n 2:                     Brain-Cerebellum   BRNCB       2     241\n 3:           Brain-CerebellarHemisphere  BRNCBH       3     215\n 4:        Brain-Spinalcord_cervicalc-1_  BRNSPC       4     159\n 5:                              Thyroid THYROID       5     653\n 6:                             Prostate  PRSTTE       6     245\n 7:                         Nerve-Tibial  NERVET       7     619\n 8:                               Spleen  SPLEEN       8     241\n 9:                            Pituitary  PTTARY       9     283\n10:                Brain-Substantianigra  BRNSNG      10     139\n11:                                Ovary   OVARY      11     180\n12:                                 Lung    LUNG      12     578\n13:                        Kidney-Cortex  KDNCTX      13      85\n14:                    Brain-Hippocampus  BRNHPC      14     197\n15:         SmallIntestine-TerminalIleum  SNTTRM      15     187\n16:                 Breast-MammaryTissue  BREAST      16     459\n17:                               Uterus  UTERUS      17     142\n18:                   Brain-Hypothalamus  BRNHPT      18     202\n19:       Skin-NotSunExposed_Suprapubic_  SKINNS      19     604\n20:                         Brain-Cortex   BRNCT      20     255\n21:                               Vagina  VAGINA      21     156\n22:                 Adipose-Subcutaneous  ADPSBO      22     663\n23:                       Brain-Amygdala  BRNAGD      23     152\n24:          Brain-Putamen_basalganglia_  BRNPBG      24     205\n25:            Skin-SunExposed_Lowerleg_   SKINS      25     701\n26:                        Colon-Sigmoid  CLNSGM      26     373\n27:          Brain-Caudate_basalganglia_  BRNCDB      27     246\n28: Brain-Nucleusaccumbens_basalganglia_  BRNNAB      28     246\n29:            Adipose-Visceral_Omentum_  ADPVSC      29     541\n30:                     Colon-Transverse  CLNTRN      30     406\n31:   Esophagus-GastroesophagealJunction  ESPGEL      31     375\n32:  Brain-Anteriorcingulatecortex_BA24_  BRNATG      32     176\n33:             Brain-FrontalCortex_BA9_  BRNFCT      33     209\n34:                           WholeBlood  WHLBLD      34     755\n35:                   MinorSalivaryGland  SLVRYG      35     162\n36:                 Esophagus-Muscularis  ESPMSL      36     515\n37:                        Artery-Tibial  ARTTBL      37     663\n38:                      Artery-Coronary  ARTCRN      38     240\n39:                              Stomach  STMACH      39     359\n40:                         Artery-Aorta  ARTAOT      40     432\n41:                         AdrenalGland  ADNGLD      41     258\n42:                Heart-AtrialAppendage   HRTAA      42     429\n43:                                Liver   LIVER      43     226\n44:     Cells-EBV-transformedlymphocytes     LCL      44     174\n45:                     Esophagus-Mucosa  ESPMCS      45     555\n46:                  Heart-LeftVentricle   HRTLV      46     432\n47:                             Pancreas PNCREAS      47     328\n48:                      Muscle-Skeletal MUSCLSK      48     803\n49:            Cells-Culturedfibroblasts FIBRBLS      49     504\n                                  tissue   label tissuei nsample\n\n\n\n\n\nCode\nlabel_x1 &lt;- function(ids) {\n    labels[tissuei == ids, label]\n}\n\nlabel_x2 &lt;- function(ids) {\n    labels[tissuei == ids, nsample] \n}\n\n\ndf %&gt;% left_join(y = tissue.labels, by = \"tissue\") %&gt;%\n      ggplot() +\n        geom_point(aes(x = pointx, y = unprodRatio), color = 'midnightblue', alpha = .1) +\n        geom_tile(aes(x = tissuei, y = med), color = 'firebrick', fill= 'firebrick', height = 5e-5, width = .9) +\n        scale_x_continuous(\n            breaks = unique(df$tissuei), \n            labels = unique(df$label),\n            expand = c(0, .5),\n            guide = guide_axis(angle = 90),\n            sec.axis = sec_axis(~., \n                                breaks = unique(df$tissuei),\n                                labels = label_x2,  \n                                guide = guide_axis(angle = 90)\n                               )\n            ) +\n        scale_y_continuous(labels = scales::percent_format(accuracy = .1)) +\n        labs(x = \"Tissue / Number of Samples\",\n            y = \"Fraction of unproductive reads\"\n            )\n\n\n\n\n\n\n\n\nFigure 1: Unproductive splicing ratio in GTEx across tissues"
  },
  {
    "objectID": "analysis/2024-06-20-GTEx-DGE-vs-DS-TissueExample.html",
    "href": "analysis/2024-06-20-GTEx-DGE-vs-DS-TissueExample.html",
    "title": "Differential splicing vs differential gene expression in Selected Tissue pairs",
    "section": "",
    "text": "This notebook produces the comparison of differential splicing and differential gene expression. Pre-processed data are under ../../SpliFi/data/ds_v_dge/{tissue2}_v_{tissue1}_data.rds\n\n\nHere, I try to compare the correlation between unproductive splicing and gene expression across all GTEx tissue pairs.\n\n\n\n\nCode\nread_contrast &lt;- function(rds, contrast, PSI = 0.1, FDR = 1e-5, selection = 'all') {\n  #' @params rds: path to rds file'\n  #' @params contrast: contrast name'\n  #' @params FDR: FDR threshold'\n  #' @params selection: 'all', 'maxClu', 'maxGene'.\n  #'                    Select all introns, max deltaPSI per cluster, or max deltaPSI per gene'\n\n\n\n  data &lt;- readRDS(rds)\n  ds &lt;- data$ds\n  dge &lt;- data$dge\n  dge_dsc &lt;- data$dge_dsc\n\n  joined_dt &lt;- inner_join(\n    x = ds[abs(deltapsi) &gt; PSI & `p.adjust` &lt; FDR & ctype %in% c('PR', 'PR,UP'), \n          .(gene_id, gene_name, intron, cluster, itype, ctype, deltapsi)],\n    y = dge[, .(gene_id, g_l2fc = log2FoldChange, g_z = stat, g_l2fcSE = lfcSE)],\n    by = 'gene_id'\n  )\n\n  if (selection == 'maxClu') {\n    # select the max deltaPSI per cluster, stratified by UP and PR.\n    joined_dt  &lt;- joined_dt[\n      , .(intron, \n          deltapsi, \n          g_l2fc,\n          g_z,\n          g_l2fcSE,\n          rk = rank(-abs(deltapsi), ties.method = \"first\")\n         ), \n      by = .(gene_id, gene_name, cluster, ctype, itype)\n    ][rk == 1, -c('rk')]\n  } else if (selection == 'maxGene') {\n    # select the max deltaPSI per gene, stratified by UP and PR.\n    joined_dt &lt;- joined_dt[\n      , .(intron,\n          deltapsi,\n          g_l2fc,\n          g_z,\n          g_l2fcSE,\n          rk = rank(-abs(deltapsi), ties.method = \"first\")\n         ), \n      by = .(gene_id, gene_name, itype)\n    ][rk == 1, -c('rk')]\n  }\n\n  # run cor.test\n  cor_res &lt;- joined_dt %&gt;% \n    split(by = 'itype') %&gt;% \n    map(~cor.test(x = .x$g_z, y = .x$deltapsi, method = 'pearson')) %&gt;% \n    imap_dfr(\n      \\(x, y) {\n        data.table(\n          cor = x$estimate,\n          p = x$`p.value`,\n          itype = y,\n          contrast = contrast)\n      }\n    )\n\n    # plot scatter plot\n    p  &lt;- joined_dt %&gt;% \n      ggplot() + \n        geom_pointdensity(aes(g_z, deltapsi), size = .5, alpha = .5) +\n        scale_color_viridis_c() + \n        geom_smooth(aes(g_z, deltapsi), method = \"lm\", formula = y~x, se = FALSE, color = 'blue', lwd = 1) +\n        geom_text(aes(x = 0,\n                      y = 0.1, \n                      label = paste(\"cor: \", round(cor, 3), \", \",\n                                    \"p. val: \", format(p, digits = 3, scientific = T), \n                                    sep = \"\")\n                      ),\n                  data = cor_res, color = 'blue', size = 4, vjust = 1) +\n        labs(x = \"DGE: Z-score\",\n             y = \"DS: deltaPSI\",\n             color = \"Num. points\", \n             title = str_wrap(str_replace_all(contrast, '_', ' '), width = 40),\n             caption = glue(\"N: {nrow(joined_dt)}, \",\n                             \"FDR: {FDR}, \",\n                             \"min |PSI|: {PSI}, \")\n            ) +\n        facet_wrap(~itype)\n\n    return(list(cor_res = cor_res, gg = p, joineddf = joined_dt))\n\n}\n\n\nLoad contrast ds, dge data.\nrds file and contrast name example:\n\n\nCode\nrds_list &lt;- dir('/project/yangili1/cdai/SpliFi/data/ds_v_dge', full.names = T, pattern = '*.rds')\nrds_list &lt;- rds_list[str_detect(rds_list, \".+ds_v_dge.+_v_.+data.rds\")]\ncontrast_list &lt;- str_split(rds_list, \"/\") %&gt;% map(., last) %&gt;% unlist %&gt;% str_remove_all('_data\\\\.rds')\n\nselected_tissue_pairs &lt;- c(\n  \"Brain-Cortex_v_Muscle-Skeletal\",\n  \"Brain-Cortex_v_Liver\",\n  \"Brain-Cortex_v_WholeBlood\"\n)\n\ncontrast_list &lt;- map_chr(selected_tissue_pairs,\n    ~contrast_list[str_detect(contrast_list, .x)])\nrds_list &lt;- map_chr(selected_tissue_pairs,\n    ~rds_list[str_detect(rds_list, .x)])\n\ncontrast_list\n\n\n[1] \"Brain-Cortex_v_Muscle-Skeletal\" \"Brain-Cortex_v_Liver\"          \n[3] \"Brain-Cortex_v_WholeBlood\"     \n\n\nCode\nrds_list\n\n\n[1] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Brain-Cortex_v_Muscle-Skeletal_data.rds\"\n[2] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Brain-Cortex_v_Liver_data.rds\"          \n[3] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Brain-Cortex_v_WholeBlood_data.rds\"     \n\n\n\n\nCode\nFDR &lt;- params$fdr\nminPSI &lt;- params$psi\n\n\nProcess all the contrast data using FDR=1e-5:\n\n\nCode\nres1 &lt;- map2(rds_list, contrast_list, read_contrast, PSI = minPSI, FDR = FDR, selection = 'maxClu')\ndf1 &lt;- map_dfr(res1, ~.x$cor_res)\n\n\n\n\nCode\nres2 &lt;- map2(rds_list, contrast_list, read_contrast, PSI = minPSI, FDR = FDR, selection = 'maxGene')\ndf2 &lt;- map_dfr(res2, ~.x$cor_res)\n\n\n\n\nCode\nres3 &lt;- map2(rds_list, contrast_list, read_contrast, PSI = minPSI, FDR = FDR, selection = 'all')\ndf3 &lt;- map_dfr(res3, ~.x$cor_res)\n\n\n\n\nCode\nggs1 &lt;- map(res1, ~.x$gg)\n\nggs1[[1]] + ggs1[[2]] + ggs1[[3]] + plot_layout(ncol = 3, guides = 'collect')\n\n\n\n\n\n\n\n\nFigure 1: Select 1 best intron per cluster\n\n\n\n\n\n\n\nCode\nggs2 &lt;- map(res2, ~.x$gg)\n\nggs2[[1]] + ggs2[[2]] + ggs2[[3]] + plot_layout(ncol = 3, guides = 'collect')\n\n\n\n\n\n\n\n\nFigure 2: Select 1 best intron per gene\n\n\n\n\n\n\n\nCode\nggs3 &lt;- map(res3, ~.x$gg)\n\nggs3[[1]] + ggs3[[2]] + ggs3[[3]] + plot_layout(ncol = 3, guides = 'collect')\n\n\n\n\n\n\n\n\nFigure 3: Select all introns in cluster\n\n\n\n\n\n\n\nCode\nres3[[1]]$joineddf %&gt;% DT::datatable()\n\n\n\n\nTable 1: joined data for selecting 1 best intron per cluster"
  },
  {
    "objectID": "analysis/2024-06-20-GTEx-DGE-vs-DS-TissueExample.html#unproductive-splicing-vs.-expression-for-all-gtex-tissue-pairs",
    "href": "analysis/2024-06-20-GTEx-DGE-vs-DS-TissueExample.html#unproductive-splicing-vs.-expression-for-all-gtex-tissue-pairs",
    "title": "Differential splicing vs differential gene expression in Selected Tissue pairs",
    "section": "",
    "text": "Here, I try to compare the correlation between unproductive splicing and gene expression across all GTEx tissue pairs.\n\n\n\n\nCode\nread_contrast &lt;- function(rds, contrast, PSI = 0.1, FDR = 1e-5, selection = 'all') {\n  #' @params rds: path to rds file'\n  #' @params contrast: contrast name'\n  #' @params FDR: FDR threshold'\n  #' @params selection: 'all', 'maxClu', 'maxGene'.\n  #'                    Select all introns, max deltaPSI per cluster, or max deltaPSI per gene'\n\n\n\n  data &lt;- readRDS(rds)\n  ds &lt;- data$ds\n  dge &lt;- data$dge\n  dge_dsc &lt;- data$dge_dsc\n\n  joined_dt &lt;- inner_join(\n    x = ds[abs(deltapsi) &gt; PSI & `p.adjust` &lt; FDR & ctype %in% c('PR', 'PR,UP'), \n          .(gene_id, gene_name, intron, cluster, itype, ctype, deltapsi)],\n    y = dge[, .(gene_id, g_l2fc = log2FoldChange, g_z = stat, g_l2fcSE = lfcSE)],\n    by = 'gene_id'\n  )\n\n  if (selection == 'maxClu') {\n    # select the max deltaPSI per cluster, stratified by UP and PR.\n    joined_dt  &lt;- joined_dt[\n      , .(intron, \n          deltapsi, \n          g_l2fc,\n          g_z,\n          g_l2fcSE,\n          rk = rank(-abs(deltapsi), ties.method = \"first\")\n         ), \n      by = .(gene_id, gene_name, cluster, ctype, itype)\n    ][rk == 1, -c('rk')]\n  } else if (selection == 'maxGene') {\n    # select the max deltaPSI per gene, stratified by UP and PR.\n    joined_dt &lt;- joined_dt[\n      , .(intron,\n          deltapsi,\n          g_l2fc,\n          g_z,\n          g_l2fcSE,\n          rk = rank(-abs(deltapsi), ties.method = \"first\")\n         ), \n      by = .(gene_id, gene_name, itype)\n    ][rk == 1, -c('rk')]\n  }\n\n  # run cor.test\n  cor_res &lt;- joined_dt %&gt;% \n    split(by = 'itype') %&gt;% \n    map(~cor.test(x = .x$g_z, y = .x$deltapsi, method = 'pearson')) %&gt;% \n    imap_dfr(\n      \\(x, y) {\n        data.table(\n          cor = x$estimate,\n          p = x$`p.value`,\n          itype = y,\n          contrast = contrast)\n      }\n    )\n\n    # plot scatter plot\n    p  &lt;- joined_dt %&gt;% \n      ggplot() + \n        geom_pointdensity(aes(g_z, deltapsi), size = .5, alpha = .5) +\n        scale_color_viridis_c() + \n        geom_smooth(aes(g_z, deltapsi), method = \"lm\", formula = y~x, se = FALSE, color = 'blue', lwd = 1) +\n        geom_text(aes(x = 0,\n                      y = 0.1, \n                      label = paste(\"cor: \", round(cor, 3), \", \",\n                                    \"p. val: \", format(p, digits = 3, scientific = T), \n                                    sep = \"\")\n                      ),\n                  data = cor_res, color = 'blue', size = 4, vjust = 1) +\n        labs(x = \"DGE: Z-score\",\n             y = \"DS: deltaPSI\",\n             color = \"Num. points\", \n             title = str_wrap(str_replace_all(contrast, '_', ' '), width = 40),\n             caption = glue(\"N: {nrow(joined_dt)}, \",\n                             \"FDR: {FDR}, \",\n                             \"min |PSI|: {PSI}, \")\n            ) +\n        facet_wrap(~itype)\n\n    return(list(cor_res = cor_res, gg = p, joineddf = joined_dt))\n\n}\n\n\nLoad contrast ds, dge data.\nrds file and contrast name example:\n\n\nCode\nrds_list &lt;- dir('/project/yangili1/cdai/SpliFi/data/ds_v_dge', full.names = T, pattern = '*.rds')\nrds_list &lt;- rds_list[str_detect(rds_list, \".+ds_v_dge.+_v_.+data.rds\")]\ncontrast_list &lt;- str_split(rds_list, \"/\") %&gt;% map(., last) %&gt;% unlist %&gt;% str_remove_all('_data\\\\.rds')\n\nselected_tissue_pairs &lt;- c(\n  \"Brain-Cortex_v_Muscle-Skeletal\",\n  \"Brain-Cortex_v_Liver\",\n  \"Brain-Cortex_v_WholeBlood\"\n)\n\ncontrast_list &lt;- map_chr(selected_tissue_pairs,\n    ~contrast_list[str_detect(contrast_list, .x)])\nrds_list &lt;- map_chr(selected_tissue_pairs,\n    ~rds_list[str_detect(rds_list, .x)])\n\ncontrast_list\n\n\n[1] \"Brain-Cortex_v_Muscle-Skeletal\" \"Brain-Cortex_v_Liver\"          \n[3] \"Brain-Cortex_v_WholeBlood\"     \n\n\nCode\nrds_list\n\n\n[1] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Brain-Cortex_v_Muscle-Skeletal_data.rds\"\n[2] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Brain-Cortex_v_Liver_data.rds\"          \n[3] \"/project/yangili1/cdai/SpliFi/data/ds_v_dge/Brain-Cortex_v_WholeBlood_data.rds\"     \n\n\n\n\nCode\nFDR &lt;- params$fdr\nminPSI &lt;- params$psi\n\n\nProcess all the contrast data using FDR=1e-5:\n\n\nCode\nres1 &lt;- map2(rds_list, contrast_list, read_contrast, PSI = minPSI, FDR = FDR, selection = 'maxClu')\ndf1 &lt;- map_dfr(res1, ~.x$cor_res)\n\n\n\n\nCode\nres2 &lt;- map2(rds_list, contrast_list, read_contrast, PSI = minPSI, FDR = FDR, selection = 'maxGene')\ndf2 &lt;- map_dfr(res2, ~.x$cor_res)\n\n\n\n\nCode\nres3 &lt;- map2(rds_list, contrast_list, read_contrast, PSI = minPSI, FDR = FDR, selection = 'all')\ndf3 &lt;- map_dfr(res3, ~.x$cor_res)\n\n\n\n\nCode\nggs1 &lt;- map(res1, ~.x$gg)\n\nggs1[[1]] + ggs1[[2]] + ggs1[[3]] + plot_layout(ncol = 3, guides = 'collect')\n\n\n\n\n\n\n\n\nFigure 1: Select 1 best intron per cluster\n\n\n\n\n\n\n\nCode\nggs2 &lt;- map(res2, ~.x$gg)\n\nggs2[[1]] + ggs2[[2]] + ggs2[[3]] + plot_layout(ncol = 3, guides = 'collect')\n\n\n\n\n\n\n\n\nFigure 2: Select 1 best intron per gene\n\n\n\n\n\n\n\nCode\nggs3 &lt;- map(res3, ~.x$gg)\n\nggs3[[1]] + ggs3[[2]] + ggs3[[3]] + plot_layout(ncol = 3, guides = 'collect')\n\n\n\n\n\n\n\n\nFigure 3: Select all introns in cluster\n\n\n\n\n\n\n\nCode\nres3[[1]]$joineddf %&gt;% DT::datatable()\n\n\n\n\nTable 1: joined data for selecting 1 best intron per cluster"
  },
  {
    "objectID": "analysis/2024-06-25-bug-fix.html",
    "href": "analysis/2024-06-25-bug-fix.html",
    "title": "off by 1 bug",
    "section": "",
    "text": "All leafcutter2’s other functions are BED like coordinates like [0, 100). However, the solve_NMD function uses 3rd party packages that actually use GTF like 1 based coordinates like [1, 100].\nFor example, fetching of fasta sequence github permlink is using 1 based, even though the coordinates supplied is going to be 0 based due to input data being 0 based.\nseq = Seq(fa.fetch(chrom, (exon_coord[0],exon_coord[1])))+leftover\nOther relevant lines of codes will also need to change, like here, due to difference of [ ] vs [ ).\nfor c in stop_codons:\n        if strand == \"+\":\n            seed.append([c[1]])\n        else:\n            seed.append([c[0]])\nalso here\nhere"
  },
  {
    "objectID": "analysis/2024-06-25-bug-fix.html#solution",
    "href": "analysis/2024-06-25-bug-fix.html#solution",
    "title": "off by 1 bug",
    "section": "Solution",
    "text": "Solution\nThe solution is either change within the function, so all operations of solve_NMD are using 0-based index; or first convert all input (juncs, start, stop codons) to 1 based [], then revert back to 0 based [) for the returned juncs."
  },
  {
    "objectID": "analysis/2024-07-10-GTEx-sqtl-enrich.html",
    "href": "analysis/2024-07-10-GTEx-sqtl-enrich.html",
    "title": "GTEx sQTL enrichment - updated (V3)",
    "section": "",
    "text": "The underlying data for both the qqplot and the scatter plot are the from this procedure:\n\nMap sQTLs using permutation pass with QTLtools against leafcutter2 output. Each phenotype is an intron.\nPermpass result report a top SNP for each intron. Use the collection of these top SNPs to subset genotype VCF file.\nRun nominal pass for eQTL with expression data and the subsetted genotype VCF file. This effectively run regression analysis of each top sQTL SNP against gene expression.\n\nThen for the qqplot, I plotted the pvalue of expression regression for each productive vs. unproductive sQTLs top SNP.\nFor the scatter plot, each top SNP is the top SNP of a productive or unprodutive sQTL. X axis is SNP’s regression slope for gene expression, and Y axis is the regression slope of splicing.\nNote each sQTL is either a productive or unproductive sQTLs, and represent a intron cluster. A productive sQTL is a cluster that only have productive introns. The strongest intron is chosen to represent the cluster (instead of aggregated of all the introns).\nAn unproductive sQTL is a cluster that has both productive intron and unproductive introns with permutation pass q value &lt; 0.1. The best intron (largest top SNP slope) is chosen to represent the cluster as unproductive sQTL. Note, comparing to previous version, here for u-sQTLs (ctype = PR,UP) select the best unproductive intron to represent the cluster.\n\n\n\n\n\n\nNote\n\n\n\nThis update removed the following categories of SNPs from the GTEx VEP annotation file: - enhancer_d - promoter_d - promoter_flanking_region_d For qqplot, eQTL slope + vs. - snps are separated.\n\n\n\nEnrichment of sQTL in eQTL pvalues\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1\n\n\n\n\n\n\n\n\n\n\n\nFigure 2\n\n\n\n\n\n\n\n\n\n\n\nFigure 3\n\n\n\n\n\n\n\n\n\n\n\nFigure 4\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 5\n\n\n\n\n\n\n\n\n\n\n\nFigure 6\n\n\n\n\n\n\n\n\n\n\n\nFigure 7\n\n\n\n\n\n\n\n\n\n\n\nFigure 8\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 9\n\n\n\n\n\n\n\n\n\n\n\nFigure 10\n\n\n\n\n\n\n\n\n\n\n\nFigure 11\n\n\n\n\n\n\n\n\n\n\n\nFigure 12\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 13\n\n\n\n\n\n\n\n\n\n\n\nFigure 14\n\n\n\n\n\n\n\n\n\n\n\nFigure 15\n\n\n\n\n\n\n\n\n\n\n\nFigure 16\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 17\n\n\n\n\n\n\n\n\n\n\n\nFigure 18\n\n\n\n\n\n\n\n\n\n\n\nFigure 19\n\n\n\n\n\n\n\n\n\n\n\nFigure 20\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 21\n\n\n\n\n\n\n\n\n\n\n\nFigure 22\n\n\n\n\n\n\n\n\n\n\n\nFigure 23\n\n\n\n\n\n\n\n\n\n\n\nFigure 24\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 25\n\n\n\n\n\n\n\n\n\n\n\nFigure 26\n\n\n\n\n\n\n\n\n\n\n\nFigure 27\n\n\n\n\n\n\n\n\n\n\n\nFigure 28\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 29\n\n\n\n\n\n\n\n\n\n\n\nFigure 30\n\n\n\n\n\n\n\n\n\n\n\nFigure 31\n\n\n\n\n\n\n\n\n\n\n\nFigure 32\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 33\n\n\n\n\n\n\n\n\n\n\n\nFigure 34\n\n\n\n\n\n\n\n\n\n\n\nFigure 35\n\n\n\n\n\n\n\n\n\n\n\nFigure 36\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 37\n\n\n\n\n\n\n\n\n\n\n\nFigure 38\n\n\n\n\n\n\n\n\n\n\n\nFigure 39\n\n\n\n\n\n\n\n\n\n\n\nFigure 40\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 41\n\n\n\n\n\n\n\n\n\n\n\nFigure 42\n\n\n\n\n\n\n\n\n\n\n\nFigure 43\n\n\n\n\n\n\n\n\n\n\n\nFigure 44\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 45\n\n\n\n\n\n\n\n\n\n\n\nFigure 46\n\n\n\n\n\n\n\n\n\n\n\nFigure 47\n\n\n\n\n\n\n\n\n\n\n\nFigure 48\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 49\n\n\n\n\n\n\n\n\nComparison of sQTL (top SNP beta) and eQTL effect size (nominal beta of same top sQTL SNP)\n\n\n\n\n\n\nWarning\n\n\n\n\ncorrelation is actually computed with x being eqtl and y being sqtl, though the plot is labeled the other way around.\nused pearson correlation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 50: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 51: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 52: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 53: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 54: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 55: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 56: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 57: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 58: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 59: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 60: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 61: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 62: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 63: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 64: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 65: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 66: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 67: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 68: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 69: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 70: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 71: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 72: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 73: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 74: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 75: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 76: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 77: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 78: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 79: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 80: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 81: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 82: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 83: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 84: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 85: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 86: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 87: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 88: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 89: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 90: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 91: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 92: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 93: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 94: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 95: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 96: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 97: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 98: comparison of sQTL and eQTL effect size"
  },
  {
    "objectID": "analysis/2024-07-15-torus-input-prep.html",
    "href": "analysis/2024-07-15-torus-input-prep.html",
    "title": "TORUS input prep",
    "section": "",
    "text": "Problem with runing TORUS\n\ngetting lots of nan values in the output\nunderflow errors\npossible infinite loop?\n\n\n\nHow I run TORUS\n\ninput data file\n\nGenes are actually intron ids. Results are from qtltools, where beta and p-value are direct output but t-stat are calculated from p-value.\n\nzcat ../data/torus/torus_Liver_p-sqtl.txt.gz| head\n\nchr1_1000731_C_T_b38    chr1:941306:942135:clu_8_+:PR   0.410522    4.529243463388074   1.00142e-05\nchr1_1079456_A_G_b38    chr1:1082987:1084352:clu_1808_-:PR  -0.362335   -5.202902246877481  4.7261800000000006e-07\nchr1_1091327_C_A_b38    chr1:1090428:1091471:clu_1810_-:PR  -0.444126   -5.672460184876813  4.72455e-08\nchr1_1091327_C_A_b38    chr1:1091374:1091471:clu_1810_-:PR  0.382368    4.477479420903548   1.25005e-05\nchr1_1217733_G_A_b38    chr1:1217688:1218457:clu_1814_-:PR  0.604832    5.049136688493565   9.74565e-07\nchr1_1217733_G_A_b38    chr1:1217804:1218457:clu_1814_-:PR  -0.615276   -5.082449530379815  8.34233e-07\nchr1_1609890_C_T_b38    chr1:1642001:1642346:clu_1843_-:PR  -0.540764   -4.9038885121917    1.90325e-06\nchr1_1609890_C_T_b38    chr1:1642508:1645125:clu_1844_-:PR  1.04555 inf 1.22099e-17\nchr1_1609890_C_T_b38    chr1:1645262:1649498:clu_1844_-:PR  -0.865793   -7.730643217161971  4.64391e-13\nchr1_1724661_CGATG_C_b38    chr1:1707584:1708179:clu_1851_-:PR  -0.472149   -5.24117373691248   3.93775e-07\n\ngzip: stdout: Broken pipe\n\n\n\nSNP and gene map files.\n\nGenes are actually intron ids.\n\nzcat ../data/torus/torus_Liver_snp_map.txt.gz | head\nzcat ../data/torus/torus_Liver_gene_map.txt.gz | head\n\nchr1_1000731_C_T_b38    chr1    1000731\nchr1_1079456_A_G_b38    chr1    1079456\nchr1_1091327_C_A_b38    chr1    1091327\nchr1_1217733_G_A_b38    chr1    1217733\nchr1_1453870_A_C_b38    chr1    1453870\nchr1_1609890_C_T_b38    chr1    1609890\nchr1_1680059_G_A_b38    chr1    1680059\nchr1_1724661_CGATG_C_b38    chr1    1724661\nchr1_1737789_T_C_b38    chr1    1737789\nchr1_1706027_G_A_b38    chr1    1706027\n\ngzip: stdout: Broken pipe\nchr1:941306:942135:clu_8_+:PR   chr1    941307  942135\nchr1:1082987:1084352:clu_1808_-:PR  chr1    1082988 1084352\nchr1:1090428:1091471:clu_1810_-:PR  chr1    1090429 1091471\nchr1:1091374:1091471:clu_1810_-:PR  chr1    1091375 1091471\nchr1:1217688:1218457:clu_1814_-:PR  chr1    1217689 1218457\nchr1:1217804:1218457:clu_1814_-:PR  chr1    1217805 1218457\nchr1:1389047:1390229:clu_1835_-:UP  chr1    1389048 1390229\nchr1:1642001:1642346:clu_1843_-:PR  chr1    1642002 1642346\nchr1:1642508:1645125:clu_1844_-:PR  chr1    1642509 1645125\nchr1:1642508:1649498:clu_1844_-:UP  chr1    1642509 1649498\n\ngzip: stdout: Broken pipe\n\n\n\nSNP annotation file\n\nDownloaded from GTEx protal\n\nzcat ../data/WGS_Feature_overlap_collapsed_VEP_short_4torus.MAF01.txt.gz | head | cut -f 1-5\n\nSNP enhancer_d  promoter_d  open_chromatin_region_d promoter_flanking_region_d\nchr1_13550_G_A_b38  1   0   0   0\nchr1_14671_G_C_b38  0   0   0   0\nchr1_14677_G_A_b38  0   0   0   0\nchr1_16841_G_T_b38  0   0   0   0\nchr1_16856_A_G_b38  0   0   0   0\nchr1_17005_A_G_b38  0   0   0   0\nchr1_17147_G_A_b38  0   0   0   0\nchr1_17407_G_A_b38  0   0   0   0\nchr1_17408_C_G_b38  0   0   0   0\n\ngzip: stdout: Broken pipe\n\n\n\nRun TORUS\n\n\ntorus -est \\\n  -d ../data/torus/torus_Liver_p-sqtl.txt.gz \\\n  -smap ../data/torus/torus_Liver_snp_map.txt.gz \\\n  -gmap ../data/torus/torus_Liver_gene_map.txt.gz \\\n  -annot ../data/WGS_Feature_overlap_collapsed_VEP_short_4torus.MAF01.txt.gz &gt; ../data/torus/Liver-p-enrichment.txt\ntorus -est \\\n  -d ../data/torus/torus_Liver_u-sqtl.txt.gz \\\n  -smap ../data/torus/torus_Liver_snp_map.txt.gz \\\n  -gmap ../data/torus/torus_Liver_gene_map.txt.gz \\\n  -annot ../data/WGS_Feature_overlap_collapsed_VEP_short_4torus.MAF01.txt.gz &gt; ../data/torus/Liver-u-enrichment.txt\n\n\nResults\n\nLots of nan values in stdout and the final output. Many seems to be in infinit loop?\n\ncat ../data/torus/torus_Spleen_enrichment_p-sqtl.txt\n\n\n                Intercept     25.061        24.360     25.761\n               enhancer.1      4.669     -64709.147  64718.485\n               promoter.1     -0.001       -19.319     19.316\n  open_chromatin_region.1     -0.001       -19.539     19.536\npromoter_flanking_region.1      0.015      -209.060    209.090\n      CTCF_binding_site.1     -0.002       -26.457     26.454\n        TF_binding_site.1      4.925     -68245.675  68255.525\n    3_prime_UTR_variant.1      2.918     -40441.404  40447.240\n    5_prime_UTR_variant.1      3.661     -50737.866  50745.188\n     frameshift_variant.1     10.619     -147161.543  147182.781\n         intron_variant.1      0.054      -745.464    745.571\n       missense_variant.1      2.755     -38174.010  38179.519\nnon_coding_transcript_exon_variant.1      1.781     -24679.474  24683.035\nsplice_acceptor_variant.1     10.076     -139633.278  139653.430\n   splice_donor_variant.1      6.575     -91115.245  91128.394\n  splice_region_variant.1      5.130     -71092.879  71103.139\n            stop_gained.1      8.484     -117570.204  117587.171\n     synonymous_variant.1      4.289     -59431.429  59440.006\n\n\n\n\nTORUS instructed data format\nFrom torus\n\ninput data file\n\nSNP gene    beta     t-stat p-value\n1_30923_G_T_b37 ENSG00000227232.4   0.00399184253633977 0.0232610959574911  0.981503781647425\n1_51479_T_A_b37 ENSG00000227232.4   -0.0264207753473278 -0.101592859539226  0.919350965625195\n1_55299_C_T_b37 ENSG00000227232.4   -0.224656599916996  -0.977243563498281  0.331590265844854\n\n\nSNP annotation file\n\nSNP   binding_d\nchr1.51479  0\nchr1.52058  2\nchr1.52238  1\n\nSNP and gene map files\n\nTo control for SNP distance to TSS, TORUS requires gene TSS information and SNP position files (i.e., gene map and SNP map).\nGene map file format:\nENSG00000237683  1  139379 139379\nENSG00000237491  1  714162 714162\nENSG00000230021  1  741274 741274\nsnps map\nchr1.51479  1  51479\nchr1.52058  1  52058\nchr1.52238  1  52238\n\n\nOutput from enrichment analysis\n\nThe first column represents the annotation name and its corresponding level (for a categorical variable). The second column is the point estimate (MLE) of the log odds ratio. Columns 3-4 represent the 95% confidence interval for the corresponding point estimate.\nbinding.1      0.623         0.226      1.021\nbinding.2      1.222         0.946      1.499\n\n\nMatrixEQTL format\nSNP map file format:\nsnp chr pos\nSnp_01  chr1    721289\nSnp_02  chr1    752565\nSnp_03  chr1    777121\nSnp_04  chr1    785988\nSnp_05  chr1    792479\nSnp_06  chr1    798958\nGENE map file format:\ngeneid  chr s1  s2\nGene_01 chr1    721289  731289\nGene_02 chr1    752565  762565\nGene_03 chr1    777121  787121\nGene_04 chr1    785988  795988\nGene_05 chr1    792479  802479\nGene_06 chr1    798958  808958\nGene_07 chr1    888658  898658"
  },
  {
    "objectID": "analysis/2024-07-16-sQTL-beta-beta-plot-check-Liver.html",
    "href": "analysis/2024-07-16-sQTL-beta-beta-plot-check-Liver.html",
    "title": "Check sqtl beta beta corr plot - Liver",
    "section": "",
    "text": "Check sqtl beta beta corr plot\n\n\n[1] \"../smk-plots/gtex-sqtl-enrichment-v4/Cells-EBV-transformedlymphocytes-scatter.png\"\n[2] \"../smk-plots/gtex-sqtl-enrichment-v4/Liver-scatter.png\"                           \n[3] \"../smk-plots/gtex-sqtl-enrichment-v4/WholeBlood-scatter.png\"                      \n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 2: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\n\n\n\nFigure 3: comparison of sQTL and eQTL effect size\n\n\n\n\n\n\n\n\nTake a closer look at whole blood\nConsider selecting random intron for PR also try random selection for UP\n\n\nRemoved 67 transcriptional snps\n\n\n\n\nWarning: Transformation introduced infinite values in continuous x-axis\n\n\nWarning: Removed 450 rows containing non-finite values (`stat_ecdf()`).\n\n\n\n\n\n\n\n\n\nRemove introns with low read counts (less than 10 reads).\n\n\n[1] \"Number of sQTLs removed due to low read counts:\"\n\n\n   ctype   N\n1:    PR 536\n2: PR,UP  73\n\n\n[1] \"Number of sQTLs remaining:\"\n\n\n   ctype   N\n1:    PR 675\n2: PR,UP 520\n\n\nCorrelation test for Liver:\nOriginal:\n\n\n          ctype         pval   estimate xpos ypos\nPR   Productive 1.569125e-04 -0.1440360    0    0\nUP Unproductive 1.205498e-12 -0.3037351    0    0\n\n\nsplit by intron bins:\n\n\n    ctype binsbyMean   N\n 1:    PR      (0,1] 227\n 2:    PR      (1,2] 133\n 3:    PR      (2,5] 178\n 4:    PR     (5,10] 146\n 5:    PR    (10,20] 169\n 6:    PR    (20,50] 145\n 7:    PR   (50,100]  95\n 8:    PR  (100,Inf] 131\n 9: PR,UP      (0,1] 202\n10: PR,UP      (1,2] 106\n11: PR,UP      (2,5] 123\n12: PR,UP     (5,10]  93\n13: PR,UP    (10,20]  39\n14: PR,UP    (20,50]  24\n15: PR,UP   (50,100]   8\n16: PR,UP  (100,Inf]   4\n\n\n\n\n\n\n\n\n\n\n\nbefore removing low reads\n\n\n\n\n\n\n\n\n\nafter removing low reads\n\n\n\n\n\n\n\nFigure 4: Beta beta correlation plot for Liver:\n\n\n\n\n\n$`(0,1]`\n          ctype         pval   estimate xpos ypos\nPR   Productive 8.193055e-10 -0.3932333    0    0\nUP Unproductive 1.139917e-12 -0.4732474    0    0\n\n$`(1,2]`\n          ctype       pval   estimate xpos ypos\nUP Unproductive 0.02968139 -0.2113030    0    0\nPR   Productive 0.43620741 -0.0680786    0    0\n\n$`(10,20]`\n          ctype      pval    estimate xpos ypos\nPR   Productive 0.4299658 -0.06110832    0    0\nUP Unproductive 0.8583073  0.02954254    0    0\n\n$`(100,Inf]`\n          ctype       pval   estimate xpos ypos\nPR   Productive 0.02455384  0.1964043    0    0\nUP Unproductive 0.39536401 -0.6046360    0    0\n\n$`(2,5]`\n          ctype       pval    estimate xpos ypos\nPR   Productive 0.50020538 -0.05085651    0    0\nUP Unproductive 0.05991577 -0.17013945    0    0\n\n$`(20,50]`\n          ctype      pval     estimate xpos ypos\nPR   Productive 0.9423765 -0.006055148    0    0\nUP Unproductive 0.2912667  0.224645397    0    0\n\n$`(5,10]`\n          ctype      pval    estimate xpos ypos\nPR   Productive 0.2736122  0.09119975    0    0\nUP Unproductive 0.1549035 -0.14868809    0    0\n\n$`(50,100]`\n          ctype      pval     estimate xpos ypos\nPR   Productive 0.3968099  0.087929945    0    0\nUP Unproductive 0.9959961 -0.002135432    0    0"
  },
  {
    "objectID": "analysis/2024-07-16-sQTL-procedure.html",
    "href": "analysis/2024-07-16-sQTL-procedure.html",
    "title": "sQTL procedure",
    "section": "",
    "text": "bed: phenotype bed file\ncov: covariate file\nvcf: genotype vcf file\n\n\n\nUsed a python script to prepare phenotype for QTLtools.\n\nintrons with missing PSI ratios from over 40% of samples are removed.\nintrons with less than 0.005 std are also removed.\nPSI values from leafcutter output are added with pseudo count of 0.5.\n\n\ncount = (float(num) + 0.5) / ((float(denom)) + 0.5)\n\n\nPSI values are quantile normalized\n\n\ndef qqnorm(x):\n    n = len(x)\n    a = 3.0 / 8.0 if n &lt;= 10 else 0.5\n    return norm.ppf((rankdata(x) - a) / (n + 1.0 - 2.0 * a))\n\n# qqnorms on the columns\nmatrix = np.array(valRows)\nfor i in range(len(matrix[0, :])):\n    matrix[:, i] = qqnorm(matrix[:, i])"
  },
  {
    "objectID": "analysis/2024-07-16-sQTL-procedure.html#phenotype-bed-file",
    "href": "analysis/2024-07-16-sQTL-procedure.html#phenotype-bed-file",
    "title": "sQTL procedure",
    "section": "",
    "text": "Used a python script to prepare phenotype for QTLtools.\n\nintrons with missing PSI ratios from over 40% of samples are removed.\nintrons with less than 0.005 std are also removed.\nPSI values from leafcutter output are added with pseudo count of 0.5.\n\n\ncount = (float(num) + 0.5) / ((float(denom)) + 0.5)\n\n\nPSI values are quantile normalized\n\n\ndef qqnorm(x):\n    n = len(x)\n    a = 3.0 / 8.0 if n &lt;= 10 else 0.5\n    return norm.ppf((rankdata(x) - a) / (n + 1.0 - 2.0 * a))\n\n# qqnorms on the columns\nmatrix = np.array(valRows)\nfor i in range(len(matrix[0, :])):\n    matrix[:, i] = qqnorm(matrix[:, i])"
  },
  {
    "objectID": "analysis/2024-08-05-GTEx-sqtl-enrich.html",
    "href": "analysis/2024-08-05-GTEx-sqtl-enrich.html",
    "title": "GTEx sQTL enrichment - updated (V4) - different pseudocount",
    "section": "",
    "text": "Note\n\n\n\nChanged pseducount count method in phenotype prep script\n\nfrom: \\(\\frac{num + 0.5 }{ denom + 0.5}\\)\nto : \\(\\frac{num + addon }{ denom + addon}\\), where addon = denom * .01 if denom &lt; 100 else 0.05\n\n\n\nThe underlying data for both the qqplot and the scatter plot are the from this procedure:\n\nMap sQTLs using permutation pass with QTLtools against leafcutter2 output. Each phenotype is an intron.\nPermpass result report a top SNP for each intron. Use the collection of these top SNPs to subset genotype VCF file.\nRun nominal pass for eQTL with expression data and the subsetted genotype VCF file. This effectively run regression analysis of each top sQTL SNP against gene expression.\n\nThen for the qqplot, I plotted the pvalue of expression regression for each productive vs. unproductive sQTLs top SNP.\nFor the scatter plot, each top SNP is the top SNP of a productive or unprodutive sQTL. X axis is SNP’s regression slope for gene expression, and Y axis is the regression slope of splicing.\nNote each sQTL is either a productive or unproductive sQTLs, and represent a intron cluster. A productive sQTL is a cluster that only have productive introns. The strongest intron is chosen to represent the cluster (instead of aggregated of all the introns).\nAn unproductive sQTL is a cluster that has both productive intron and unproductive introns with permutation pass q value &lt; 0.1. The best intron (largest top SNP slope) is chosen to represent the cluster as unproductive sQTL. Note, comparing to previous version, here for u-sQTLs (ctype = PR,UP) select the best unproductive intron to represent the cluster.\n\n\n\n\n\n\nNote\n\n\n\nThis update removed the following categories of SNPs from the GTEx VEP annotation file:\n\nenhancer_d\npromoter_d\npromoter_flanking_region_d\n\nqqplot Y axis is flipped if sQTL slope and eQTL slope are in opposite direction.\n\n\n\nEnrichment of sQTL in eQTL pvalues\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1: qqplot of eQTL pvalues of sQTL top SNPs (new pseudocount)\n\n\n\n\n\n\n\n\n\n\n\nFigure 2: qqplot of eQTL pvalues of sQTL top SNPs (new pseudocount)\n\n\n\n\n\n\n\n\n\n\n\nFigure 3: qqplot of eQTL pvalues of sQTL top SNPs (new pseudocount)\n\n\n\n\n\n\n\n\n\n\n\nFigure 4: qqplot of eQTL pvalues of sQTL top SNPs (new pseudocount)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 5\n\n\n\n\n\n\n\n\n\n\n\nFigure 6\n\n\n\n\n\n\n\n\n\n\n\nFigure 7\n\n\n\n\n\n\n\n\n\n\n\nFigure 8\n\n\n\n\n\n\n\n\nComparison of sQTL (top SNP beta) and eQTL effect size (nominal beta of same top sQTL SNP)\n\n\n\n\n\n\nNote\n\n\n\n\ncor.test used pearson correlation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 9: comparison of sQTL and eQTL effect size (new pseudocount)\n\n\n\n\n\n\n\n\n\n\n\nFigure 10: comparison of sQTL and eQTL effect size (new pseudocount)\n\n\n\n\n\n\n\n\n\n\n\nFigure 11: comparison of sQTL and eQTL effect size (new pseudocount)\n\n\n\n\n\n\n\n\n\n\n\nFigure 12: comparison of sQTL and eQTL effect size (new pseudocount)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 13: comparison of sQTL and eQTL effect size (old)\n\n\n\n\n\n\n\n\n\n\n\nFigure 14: comparison of sQTL and eQTL effect size (old)\n\n\n\n\n\n\n\n\n\n\n\nFigure 15: comparison of sQTL and eQTL effect size (old)\n\n\n\n\n\n\n\n\n\n\n\nFigure 16: comparison of sQTL and eQTL effect size (old)"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html",
    "title": "Process GWAS summary stats",
    "section": "",
    "text": "GWAS\nTrait\n\n\n\n\nAD\nAlzheimer's disease\n\n\nPD\nParkinson's disease\n\n\nT2D\nType 2 diabetes\n\n\nHT\nHeight\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nGWAS\nPath\n\n\n\n\nAD\n/project/yangili1/cdai/SpliFi/code/resources/GWAS/zpmu-GWAS_loci/AD_sumstats_Jansenetal.txt.gz\n\n\nPD\n/project/yangili1/cdai/SpliFi/code/resources/GWAS/zpmu-GWAS_loci/pkd_nallsEtAl2019_excluding23andMe_allVariants.tab.gz\n\n\nT2D\n/project/yangili1/cdai/SpliFi/code/resources/GWAS/zpmu-GWAS_loci/Mahajan.NatGenet2018b.T2D.European.txt.gz\n\n\nHT\n/project/yangili1/cdai/SpliFi/code/resources/GWAS/zpmu-GWAS_loci/Locke_height_UKBiobank_2018.txt.gz"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html#ad",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html#ad",
    "title": "Process GWAS summary stats",
    "section": "AD",
    "text": "AD\n\nTotal Number of SNPs: 13,367,299;\nNumber of SNPs with P-value &lt; 10^{-5}: 1,457,396;\n\n\n\n\n\n\n\n\n\n\nuniqID.a1a2\nCHR\nBP\nA1\nA2\nSNP\nZ\nP\nNsum\nNeff\ndir\nMAF\nBETA\nSE\n\n\n\n\n1:715265_T_C\n1\n715265\nT\nC\nrs12184267\n2.121973\n0.03384\n381761\n381761\n??+?\n0.0408069\n0.01227458\n0.005784513\n\n\n1:715367_G_A\n1\n715367\nG\nA\nrs12184277\n1.957915\n0.05024\n382151\n382151\n??+?\n0.0410687\n0.01128522\n0.005763896\n\n\n1:717485_A_C\n1\n717485\nA\nC\nrs12184279\n1.912438\n0.05582\n382180\n382180\n??+?\n0.0405759\n0.01108656\n0.005797083\n\n\n1:720381_T_G\n1\n720381\nT\nG\nrs116801199\n2.295404\n0.02171\n382954\n382954\n??+?\n0.0421620\n0.01305152\n0.005685937\n\n\n1:721290_C_G\n1\n721290\nC\nG\nrs12565286\n2.315602\n0.02058\n382779\n382779\n??+?\n0.0423776\n0.01313731\n0.005673389\n\n\n1:723891_G_C\n1\n723891\nG\nC\nrs2977670\n2.468185\n0.01358\n381362\n381362\n??+?\n0.0631200\n0.01162158\n0.004708552"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html#pd",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html#pd",
    "title": "Process GWAS summary stats",
    "section": "PD",
    "text": "PD\n\nTotal Number of SNPs: 17,510,617;\nNumber of SNPs with P-value &lt; 10^{-5}: 5,806;\n\n\n\n\n\n\n\n\n\n\nSNP\nA1\nA2\nfreq\nb\nse\np\nN_cases\nN_controls\n\n\n\n\nchr11:88249377\nT\nC\n0.9931\n0.1575\n0.1783\n0.3771\n7161\n5356\n\n\nchr1:60320992\nA\nG\n0.9336\n0.0605\n0.0456\n0.1846\n26421\n442271\n\n\nchr2:18069070\nT\nC\n0.9988\n-0.6774\n1.3519\n0.6163\n582\n905\n\n\nchr8:135908647\nA\nG\n0.2081\n-0.0358\n0.0273\n0.1887\n26421\n442271\n\n\nchr12:3871714\nA\nC\n0.9972\n0.1489\n1.0636\n0.8886\n749\n658\n\n\nchr16:77148858\nA\nG\n0.9976\n-0.1213\n0.3874\n0.7543\n6248\n4391"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html#ht",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html#ht",
    "title": "Process GWAS summary stats",
    "section": "HT",
    "text": "HT\n\nTotal Number of SNPs: 2,348,397;\nNumber of SNPs with P-value &lt; 10^{-5}: 5,806;\n\n\n\n\n\n\n\n\n\n\nCHR\nPOS\nSNP\nTested_Allele\nOther_Allele\nFreq_Tested_Allele_in_HRS\nBETA\nSE\nP\nN\n\n\n\n\n7\n92383888\nrs10\nA\nC\n0.06431\n0.0006\n0.0044\n0.890\n598895\n\n\n12\n126890980\nrs1000000\nA\nG\n0.22190\n0.0001\n0.0023\n0.950\n689928\n\n\n4\n21618674\nrs10000010\nT\nC\n0.50860\n0.0008\n0.0020\n0.670\n785319\n\n\n4\n1357325\nrs10000012\nC\nG\n0.86340\n0.0034\n0.0028\n0.230\n692463\n\n\n4\n37225069\nrs10000013\nA\nC\n0.77080\n-0.0051\n0.0024\n0.034\n687856\n\n\n4\n84778125\nrs10000017\nT\nC\n0.22840\n0.0042\n0.0024\n0.073\n686123"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html#t2d",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html#t2d",
    "title": "Process GWAS summary stats",
    "section": "T2D",
    "text": "T2D\n\nTotal Number of SNPs: 23,465,132;\nNumber of SNPs with P-value &lt; 10^{-5}: 44,546;\n\n\n\n\n\n\n\n\n\n\nSNP\nChr\nPos\nEA\nNEA\nEAF\nBeta\nSE\nPvalue\nNeff\n\n\n\n\n1:100000012\n1\n100000012\nT\nG\n0.2500\n-0.0260\n0.0073\n0.00040\n231420\n\n\n1:10000006\n1\n10000006\nA\nG\n0.0047\n-0.0380\n0.0560\n0.49000\n225429\n\n\n1:100000135\n1\n100000135\nA\nT\n0.9900\n-0.0330\n0.0550\n0.55000\n226311\n\n\n1:100000436\n1\n100000436\nT\nC\n1.0000\n-0.0980\n0.1900\n0.61000\n185906\n\n\n1:100000827\n1\n100000827\nT\nC\n0.3000\n-0.0230\n0.0069\n0.00075\n231420\n\n\n1:100000843\n1\n100000843\nT\nC\n0.9400\n0.0006\n0.0140\n0.97000\n231420"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html#ad-1",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html#ad-1",
    "title": "Process GWAS summary stats",
    "section": "AD",
    "text": "AD\n\n\n\n\n\n\n\n\n\n#CHR\nBP\nid\nSNP\nZ\nP\nBETA\nSE\nNsum\nNeff\nA1\nA2\nMAF\n\n\n\n\nchr1\n779885\n1:715265_T_C\nrs12184267\n2.121973\n0.03384\n0.01227458\n0.005784513\n381761\n381761\nT\nC\n0.0408069\n\n\nchr1\n779987\n1:715367_G_A\nrs12184277\n1.957915\n0.05024\n0.01128522\n0.005763896\n382151\n382151\nG\nA\n0.0410687\n\n\nchr1\n782105\n1:717485_A_C\nrs12184279\n1.912438\n0.05582\n0.01108656\n0.005797083\n382180\n382180\nA\nC\n0.0405759\n\n\nchr1\n785001\n1:720381_T_G\nrs116801199\n2.295404\n0.02171\n0.01305152\n0.005685937\n382954\n382954\nT\nG\n0.0421620\n\n\nchr1\n785910\n1:721290_C_G\nrs12565286\n2.315602\n0.02058\n0.01313731\n0.005673389\n382779\n382779\nC\nG\n0.0423776\n\n\nchr1\n788511\n1:723891_G_C\nrs2977670\n2.468185\n0.01358\n0.01162158\n0.004708552\n381362\n381362\nG\nC\n0.0631200"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html#pd-1",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html#pd-1",
    "title": "Process GWAS summary stats",
    "section": "PD",
    "text": "PD\n\n\n\n\n\n\n\n\n\n#CHR\nBP\nid\nBETA\nSE\nP\nN_cases\nN_controls\nA1\nA2\nfreq\n\n\n\n\nchr1\n54591\nchr1:54591\n-0.6797\n0.8869\n0.44350\n527\n472\nA\nG\n0.9938\n\n\nchr1\n54676\nchr1:54676\n-0.0996\n0.0656\n0.12870\n1169\n968\nT\nC\n0.3166\n\n\nchr1\n79188\nchr1:79188\n0.6704\n0.8795\n0.44590\n527\n472\nT\nG\n0.0062\n\n\nchr1\n82994\nchr1:82994\n1.2614\n1.8502\n0.49540\n527\n472\nA\nG\n0.9984\n\n\nchr1\n86028\nchr1:86028\n-0.2158\n0.1222\n0.07745\n1169\n968\nT\nC\n0.9345\n\n\nchr1\n90231\nchr1:90231\n-1.7603\n1.8868\n0.35080\n527\n472\nA\nC\n0.0017"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html#ht-1",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html#ht-1",
    "title": "Process GWAS summary stats",
    "section": "HT",
    "text": "HT\n\n\n\n\n\n\n\n\n\n#CHR\nBP\nSNP\nBETA\nSE\nP\nN\nTested_Allele\nOther_Allele\nfreq\n\n\n\n\nchr1\n818161\nrs2073813\n-0.0041\n0.0029\n0.17\n517173\nA\nG\n0.1425\n\n\nchr1\n818812\nrs3131968\n-0.0034\n0.0029\n0.25\n551519\nA\nG\n0.1437\n\n\nchr1\n841742\nrs2980319\n-0.0027\n0.0029\n0.35\n598447\nA\nT\n0.1368\n\n\nchr1\n843942\nrs4040617\n0.0032\n0.0029\n0.27\n587624\nA\nG\n0.8647\n\n\nchr1\n845405\nrs2977612\n0.0030\n0.0029\n0.31\n582906\nA\nT\n0.8550\n\n\nchr1\n849670\nrs2905062\n0.0030\n0.0029\n0.30\n641437\nA\nG\n0.8558"
  },
  {
    "objectID": "analysis/2024-08-06-process-GWAS-summary-stats.html#t2d-1",
    "href": "analysis/2024-08-06-process-GWAS-summary-stats.html#t2d-1",
    "title": "Process GWAS summary stats",
    "section": "T2D",
    "text": "T2D\n\n\n\n\n\n\n\n\n\n#CHR\nBP\nid\nBETA\nSE\nP\nNeff\nEA\nNEA\nEAF\n\n\n\n\nchr1\n79033\n1:79033\n0.190\n0.19\n0.31\n93943\nA\nG\n0.0014\n\n\nchr1\n79137\n1:79137\n-0.043\n0.32\n0.89\n93632\nA\nT\n1.0000\n\n\nchr1\n118630\n1:118630\n0.080\n0.46\n0.86\n129175\nT\nC\n0.0004\n\n\nchr1\n597799\n1:533179\n0.250\n0.50\n0.62\n87636\nA\nG\n1.0000\n\n\nchr1\n605323\n1:540703\n0.270\n0.84\n0.74\n15329\nA\nG\n1.0000\n\n\nchr1\n609204\n1:544584\n-0.130\n0.12\n0.28\n120472\nT\nC\n0.0024"
  }
]